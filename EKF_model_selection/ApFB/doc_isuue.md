## 1. 基本式で見る **Rs・有効電力 P・電磁トルク T<sub>e</sub>** の結び付き

| 記号               | 式                                                    | 意味                            |
| ---------------- | ---------------------------------------------------- | ----------------------------- |
| **電磁トルク**        | $T_e=\tfrac32\,p\bigl(\psi_d\,i_q-\psi_q\,i_d\bigr)$ | ψ: dq 磁束，p: 極対数               |
| **有効電力**         | $P_\text{elec}=v_d i_d+v_q i_q$                      | コントローラ内部で計算可                  |
| **銅損**           | $P_\text{cu}=3R_s\bigl(i_d^2+i_q^2\bigr)$            | Rs に比例、電流二乗に比例                |
| **機械出力**         | $P_\text{mech}=T_e\,\omega_m$                        | ω<sub>m</sub>: 機械角速度          |
| **電気-機械エネルギ変換分** | $P_\text{conv}=T_e\,\omega_e$                        | ω<sub>e</sub>=p ω<sub>m</sub> |

エネルギ収支（鉄損・インバータ損は別途）

$$
P_\text{elec}=P_\text{conv}+P_\text{cu}+P_\text{iron}+P_\text{inv}.
$$

---

## 2. **Rs が変わると何が起こるか？**

### (1) トルク一定（電流で制御）

* **T<sub>e</sub> は Rs と無関係**

  * 電流コマンドと磁束が決まればトルクは決まる
    (FOC＋MTPAなら i<sub>d</sub>, i<sub>q</sub> はテーブルで決め撃ち)
* **電気入力 P<sub>elec</sub> が増減**
  $\Delta P_\text{elec} = 3\,\Delta R_s\,(i_d^2+i_q^2)$.
  例：|i| = 200 A、R<sub>s</sub> 30 mΩ → 40 mΩ (+33 %)
  ⇒ 銅損は 3 kW → 4 kW、入力電力 +1 kW。

### (2) **P→T<sub>e</sub> マッピング** を使うと

1. **マップは (P<sub>elec</sub> – P<sub>cu</sub>) vs T<sub>e</sub>** が本質

   * ところが実装上は **P<sub>elec</sub> しか測れない**
   * Rs が上がると P<sub>cu</sub> 分だけ **同じ T<sub>e</sub> でも P が増える** ⇒ マップがずれる
2. **ズレ量は電流二乗に比例**

   * 低負荷域では誤差は小さい
   * 高トルク域ほど P<sub>cu</sub> が支配的になり，補償精度が落ちる
3. **温度 1 K 上昇で Rs ≈ +0.39 % (Cu)**

   * 75 °C→125 °C (+50 K) で **Rs +20 %**，P<sub>cu</sub> も +20 %
   * 電力基準でトルクを決めると，**T<sub>e</sub> が過小になる方向** (回転機なら逆相の ω 依存あり)

---

## 3. **対策／設計アイデア**

| アプローチ                                                          | 仕組み                                                    | 長所   | クセ                    |       |                   |
| -------------------------------------------------------------- | ------------------------------------------------------ | ---- | --------------------- | ----- | ----------------- |
| **A. Rs オンライン推定**<br>(追加状態で EKF/Self-Commission)               | $x = [\ldots,R_s]$ を同時推定し，P → P\_conv = P\_elec – 3R̂s | i    | ² へ補正                 | 温度追従◎ | 実装重い，推定収束が遅いと過渡誤差 |
| **B. 温度センサ補償**                                                 | $R_s(T) = R_{20}(1+α(T-20))$ をリアルタイム計算 (α≈0.00393/K)   | 軽量   | 枚線温度センサの熱時定数が数 s〜10 s |       |                   |
| **C. 2-D/3-D P→T<sub>e</sub> マップ**<br>$f(P,V,\omega)$ を温度別に分ける | 車両 ECU に温度軸を追加し切替                                      | 実装単純 | ROM 容量・外挿誤差           |       |                   |
| **D. 二段補償**<br>電力基準 + 電流で微修正                                   | $T_e = f(P)+k(I_\text{err})$                           | 中庸   | 調整パラメータ増              |       |                   |

---

## 4. **設計時の計算式メモ**

```matlab
% --- given: measured vd, vq, id, iq, omega_e, Rs_est
P_elec = vd*id + vq*iq;             % [W]
I2     = id^2 + iq^2;
P_cu   = 3 * Rs_est * I2;           % copper loss estimate
P_conv = P_elec - P_cu;             % electromagnetic conversion
Te_est = P_conv / omega_e;          % neglecting iron/inverter loss
```

> *ω<sub>e</sub> が 0 近傍では別推定 (φ→T<sub>e</sub>) が必要*

---

## 5. まとめ

* **Rs はトルクそのものには影響しない**が、\*\*電力基準制御を使うときの“目盛り”\*\*を動かす。
* 温度 50 K 上昇で **電力⇆トルクマップが 20 % シフト** ⇒ 無補正なら高トルク域で数 10 N·m の誤差も。
* 電力ベースでトルクを補償するなら

  1. **Rs をオンライン・温度で補正**し P\_cu を引く、または
  2. **温度軸付き P→T<sub>e</sub> テーブル**を運用する――のどちらかが必須。

こうした整理を踏まえ、補償方法の優位性を評価すると良いでしょう。



いいえ、**ロック域（ ω ≈ 0 rad/s）では Rs の温度ドリフトだけでは済みません**。
電力基準をそのままトルク補償に使おうとすると、次のような追加課題があります。

| #     | 課題                          | なぜロック域で顕在化するか                                                                                                                                                             | 影響                          |
| ----- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- |
| **1** | **“0 ÷ 0” 問題**              | 電磁変換電力 $P_{\mathrm{conv}} = T_e · ω_e$ が **機械速度ゼロで必ず 0 W**。電気入力 $P_{\mathrm{elec}}$ は主に銅損と鉄損に消えるため、$P_{\mathrm{elec}}$ を ω で割ってトルクを得る式 $T_e=P_{\mathrm{conv}}/ω_e$ が破綻する。 | トルク算出不可／無限大誤差。              |
| **2** | **鉄損・ヒステリシス損が相対的に大きい**      | 機械出力 0 のため、入力電力の 10〜30 % が鉄損に相当することも。Rs を精密に補正しても鉄損分が残り、P→T マップが上下にずれる。                                                                                                   | 高トルクでも 5–15 N·m の誤差。        |
| **3** | **インバータ非理想（デッドタイム・V drop）** | ロック域では電圧の実効値が小さく、デッドタイム誤差 (数 % Vdc) が **P 計算の主要成分**になる。P 基準がそのままズレる。                                                                                                      | 電力を 5 % 誤込 → トルク換算誤差も同率で増減。 |
| **4** | **位置推定誤差→dq 変換誤差**          | センサレスで θ̂ が ±3–5° ずれると $P_{\mathrm{elec}}=v_di_d+v_qi_q$ の半分近くがクロストーク。速度ゼロは観測固有値 0 なので誤差が止まらない。                                                                           | P が虚数化／計算ノイズ → 不安定補償。       |
| **5** | **電流振幅が小さい区間の量子化ノイズ**       | 測定 i\_d,i\_q が ±1–2 A レベルだと 12-bit ADC (≃0.2 A LSB) で P が ±20 % ジッタ。                                                                                                      | 補償トルクにリップル。                 |
| **6** | **駆動周波数の高調波**               | ゼロ速域は高周波高調波注入や PWM 基波が卓越 → 実効電力を求めるには同期平均/フィルタが必須。                                                                                                                        | フィルタ遅れで 50–100 ms 要件を超える。   |

### 現実的な対処案

| 方策                 | 概要                                                | メリット        | 弱点                   |            |             |
| ------------------ | ------------------------------------------------- | ----------- | -------------------- | ---------- | ----------- |
| **A. 速度閾値切替**      | ω\_e < ω\_min（例 50 rad/s）は φ→T\_e 方式／それ以上は P→T\_e | 単純          | モード境界ハンチング           |            |             |
| **B. 定置銅損補正**      | (P\_{\mathrm{cu}}=3R\_s                           | i           | ^2) をオンラインで引いてから P→T | Rs 温度依存に強い | 鉄損・デッドタイム残る |
| **C. 鉄損モデル併用**     | P\_corr = P\_elec – P\_cu – k\_fe·f·B²            | ロック時のバイアス低減 | k\_fe 温度依存もあり        |            |             |
| **D. dq-クロスゲイン補正** | 低速時は θ̂ 誤差を推定 (PLL/EKF) し P を再算出                  | dq 直交誤差緩和   | 推定が複雑                |            |             |
| **E. 逐次学習マップ**     | ロック域で実測 T\_e をフィードバックして P→T マップを随時平行移動            | 温度・劣化を一括追従  | 学習安定化が要る             |            |             |

---

## まとめ

* **Rs 温度変化は主要因のひとつ**ですが、ロック域では「機械出力 0 W」という特殊条件が重なり、**P→T 変換そのものが ill-posed** になるため、鉄損・インバータ誤差・位相誤差など複数の要素が同等以上に効きます。
* 実務では **速度依存でモード切替**するか、**銅損＋鉄損補正モデル**を併用して初めて電力基準が成立します。

### 1 . 仕組みを数式で整理

操作量

$$
T_e^{\star}=T_{\text{ref}}+K\,(P_{\text{map}}-P_{\text{meas}})
$$

ここで

| 記号                                          | 意味                         |
| ------------------------------------------- | -------------------------- |
| $T_{\text{ref}}$                            | 通常のトルク指令（MTPA+弱め界磁などで得られる） |
| $P_{\text{map}}=f(V,\omega,T_{\text{ref}})$ | オフラインで作った **必要電力マップ**      |
| $P_{\text{meas}}=v_d i_d+v_q i_q$           | 実電力（コントローラ内部で演算）           |
| $K$                                         | ループゲイン ( Nm/W)             |

---

### 2 . ループが成立する条件と課題

| 観点                 | ポイント                                                                                 | 実務的な課題                                           |                        |                                            |     |                                                               |
| ------------------ | ------------------------------------------------------------------------------------ | ------------------------------------------------ | ---------------------- | ------------------------------------------ | --- | ------------------------------------------------------------- |
| **比例係数 $∂P/∂T_e$** | 定常近似で $P_{\text{conv}} = T_e\,\omega_e$ →  $\displaystyle \frac{∂P}{∂T_e}= \omega_e$ | *低速域*で微分係数が小さくなる → **ゲイン K を速度依存にしないと補償量が不足／過大** |                        |                                            |     |                                                               |
| \*\*銅損 (3R\_s      | i                                                                                    | ^2)\*\*                                          | ループ誤差へ線形で入る　((∆R\_s)·3 | i                                          | ^2) | 温度上昇で P\_meas 増 → ΔP<0 となり **トルクを過大に補正**<br>⇒ K が大きいとオーバーシュート |
| **鉄損・インバータ損**      | ω・電圧依存（おおよそ $k_{Fe}ω^2$、(k\_{inv}                                                    | i                                                | )）                     | マップに含めるか、ΔP が吸収——<br>でも **周波数変化が速い過渡では残差** |     |                                                               |
| **測定ノイズ**          | $P_{\text{meas}}$ は電圧・電流両方の量子化、位相ずれを含む                                               | ΔP 5 W 以内でも計算上リップル → 高ゲイン × 低慣性負荷で振動             |                        |                                            |     |                                                               |
| **帯域**             | 設計目標 50–100 ms ⇒ $-3\text{ dB}$ 5–10 Hz で十分                                          | ΔP を LPF (τ≈20 ms) → 位相遅れ 20–30 °                |                        |                                            |     |                                                               |

---

### 3 . 設計ガイドライン

| ステップ             | 推奨設定例                                                                   |                     |                                             |
| ---------------- | ----------------------------------------------------------------------- | ------------------- | ------------------------------------------- |
| **(a) 速度依存ゲイン**  | $K(ω_e)=K_0·(\omega_e/ω_{\text{base}})$ ただし $0<ω_e<ω_{\text{min}}$ では凍結 |                     |                                             |
| **(b) LPF フィルタ** | τ = 20 ms – 30 ms で ΔP を平滑                                              |                     |                                             |
| **(c) Rs 補償**    |   1. 温度センサで $R_s(T)$ を更新し \*P\_measʹ = P\_meas – 3R\_s(T)               | i                   | ^2\*<br>  2. or 小さくても PI の **I 積分**で残留誤差を消す |
| **(d) 制限**       | (                                                                       | ΔT\_e^{\text{comp}} | ) ≤ 10 %·T\_ref でクランプ                       |
| **(e) モード切替**    | ω\_e<ω\_lock (例 30 rad/s) → ΔPループ停止 or K=0                              |                     |                                             |

---

### 4 . ループ安定性をざっくり評価する式

線形化すると

$$
ΔP = \omega_e\,ΔT_e - 3\,ΔR_s\,|i|^2 + \ldots
$$

閉ループ一時方程式（LPF 1次, K 速度依存）

$$
T_e^{\star}(s) = T_{\text{ref}}(s) + \frac{K(ω_e)}{1+τs}\Bigl( P_{\text{map}}-P_{\text{meas}}(s) \Bigr)
$$

* ゲイン余裕 ≈ $1/(K·ω_e)$
* 速度ゼロでは開ループゲイン 0 → ΔP ループ **自然に無影響**（K=0 と同じ）

---

### 5 . 実装チェックリスト

1. **マップ整合**

   * 同じ Rs・温度条件で計測して作成
   * 折返し電流領域を分ける（多値防止）
2. **オンライン温度**

   * IGBT 温度 or ステータ温度を 1 Hz でサンプリング→Rs 補正
3. **診断**

   * ΔP が閾値を 100 ms 以上継続 → DTC（想定外損失）
4. **HIL ベンチ**

   * トルク階段 (±50 N·m/20 ms) と温度ランプ (+50 K/300 s) で追従を検証

---

## まとめ

* **ΔP×K をそのままトルク補正に入れる方式**では

  1. **速度ゼロに近いときのゲイン低下**
  2. **Rs 温度上昇で ΔP が負バイアス**
  3. **鉄損・デッドタイム誤差**
     を吸収できる設計が鍵。
* 実際には **速度依存ゲイン + 温度補正 (または PI 積分)** を組み合わせると、50–100 ms で安定した補正が可能になります。


### ロック域（ ω ≈ 0 rad/s ）で **ΔP × ゲイン** をトルク補正に使う場合の課題

> 先ほど列挙した ①〜⑥ のうち *どれが残り、どれが変わるか* を対比で整理します。

| #      | 以前挙げた課題（P→Te 変換が前提）             | ΔP フィードバック方式での状況                                                   | コメント／追加留意点                          |
| ------ | ------------------------------- | ------------------------------------------------------------------ | ----------------------------------- |
| **1**  | **“0 ÷ 0”問題**<br>（Te = P/ω が破綻） | **解消**◆：ω で割らないので発散は起こらない                                          | ただし次の #1′ が新たに登場                    |
| **1′** | —                               | **感度低下**◆：ロック域では 〈∂P/∂Te〉 が小さい<br>　⇒ ΔP が同じでも Te 補正量が不足しがち／高ゲインで騒音 | gain を速度依存にする、または I 積分で遅く追従させる必要    |
| **2**  | **鉄損・ヒステリシス損の寄与増大**             | **残る**◆：Pref マップに鉄損を入れないと ΔP が恒常オフセット                              | 温度・周波数で大きく変動するので温度軸 or 2 D 鉄損モデルが要る |
| **3**  | **インバータ非理想（デッドタイム等）**           | **残る**◆：P\_meas に直接混入→ΔP のバイアス源                                    | ロック域は Vd/Vq が小さく、誤差の相対寄与が増える        |
| **4**  | **dq 変換角度誤差**                   | **残る**◆：位相ズレで P\_meas に虚成分→ΔP がノイズ化                                | 速度ゼロではセンサレスθ̂ が不安定なので特に大きい          |
| **5**  | **電流・電圧量子化ノイズ**                 | **残る／悪化**◇：∂P/∂Te が小さいため同じノイズがトルクに変換されにくい→ゲインを上げればリップルが増大          | LPF τ を長めに取るか、ΔP だけ別途平均化が必要         |
| **6**  | **PWM 高調波成分**                   | **残る**◆：ΔP 計算前に同期平均・デジタル LPF が必要                                   | 帯域 5-10 Hz なら 500 Hz ローパスで十分        |

#### 新しく意識すべきポイント

| 番号    | 説明                                                                          | 実務対策                              |
| ----- | --------------------------------------------------------------------------- | --------------------------------- |
| **A** | **銅損係数がトルクの一次近似ゲインになる**<br>　$∂P/∂Te ≈ 3R_s I\,∂I/∂Te$。Rs 温度ドリフトが直接ゲインを変動させる | 温度で Rs を推定し Pref も更新／ゲインを温度依存に    |
| **B** | **Pref マップ精度がカギ**：機械出力ゼロゆえ Pref≃P\_cu+P\_fe<br>　→ 測定誤差・温度外挿がそのまま ΔP オフセット   | Pref を温度帯ごとに学習、または長期積分で平行移動       |
| **C** | **過補償リスク低減だが収束が遅い**：∂P/∂Te が小さい→大きな K が欲しいがノイズで揺れる                          | 速度ゼロだけ K を低くし、速度が上がるにつれて K を線形に増加 |

---

### まとめ

* **ロック域では**「0 ÷ 0 問題」は消える一方で、
  **“P がトルクに効きにくい”** という低感度・高ノイズの課題が新たに前面に出ます。
* Rs 温度ドリフト・鉄損・インバータ誤差・位相誤差といった **バイアス要因は引き続き残存** します。
* 実装する際は

  1. **Pref マップに鉄損と Rs(T) を反映**し、
  2. **速度依存ゲインと LPF** で低感度域を補う、
  3. 温度・長期学習で Pref を平行移動する
     …という 3 本柱で安定した補償が可能になります。

### 結論だけ先に

* **“まったく補正できない”わけではない**が、
* **ω = 0 rad/s では可観測性が急激に低下**するため、
  *DC 定常* のままでは Δφ EKF がほとんどアップデートできず、実質的に補償ゲインが 0 に近づく ――という理解でほぼ正しいです。
* どうしてもゼロ速域でも磁束側で補正したい場合は **「何かしらの励起」**（電流リップル注入・HF 高周波注入・パルス電圧チャープなど）が必須になります。

---

## 1. なぜ観測できなくなるか ― 簡易可観測性チェック

dq 電圧方程式

$$
\begin{cases}
\dot{\phi}_d = v_d - R_s i_d + \omega_e \phi_q \\
\dot{\phi}_q = v_q - R_s i_q - \omega_e \phi_d
\end{cases}
$$

### ω ≈ 0, かつ 電流・電圧が DC 定常

* 右辺は **ほぼ 0** になり
  $\dot{\phi}_d ≈ 0,\; \dot{\phi}_q ≈ 0$
* EKF の予測 **f(x, u)** と観測 **h(x)** の間に
  “磁束に絡む一次項” が残らない
  → **Jacobian H が rank 落ち** → 可観測性消失

> **イメージ**: “時計が止まった状態なので針の進み具合で時刻を合わせられない”

---

## 2. 実務で採られる 3 つの方策

| 方策                 | 内容                                                  | 長所             | 短所／実装負荷          |
| ------------------ | --------------------------------------------------- | -------------- | ---------------- |
| **A. 前回推定値ホールド**   | ω が閾値未満なら Δφ 推定をフリーズし、補償はそのまま                       | ソフト変更だけ        | 温度が動くと補償ずれ       |
| **B. 低周波電流リップル注入** | 1–10 Hz で ±ΔI サイン波を重畳し、φ→i 勾配を観測                    | 既存インバータで可      | トルク脈動・騒音、制御実装    |
| **C. HF 高周波電圧注入**  | 300–2000 Hz の小振幅 hf を d または q 軸に注入し、サリエンシ解析で磁束変化を推定 | 0 rpm でも確実に可観測 | 追加フィルタ／PLL、絶縁系考慮 |

> **補足**: HF 注入はすでにゼロ速角度推定（IPMSM）で広く使われる技術なので、
> 同じハードを流用して Δφ 推定の可観測性も確保しやすい。

---

## 3. パワー基準方式と比較したときの“ロック域の得失”

| 項目          | ΔP フィードバック     | Δφ /EKF + 何らかの励起            |
| ----------- | -------------- | --------------------------- |
| **励起要否**    | 不要（静止でも P 測定可） | 必須（HF またはリップル）              |
| **Rs 温度依存** | 銅損からバイアス       | φ 直接推定なので直接影響しない (Rs はモデルに) |
| **鉄損依存**    | 影響大            | 影響小 (計算に鉄損項が入らない)           |
| **実装負荷**    | 低              | 中〜高                         |

---

## 4. まとめの判断フロー

1. **ゼロ速で励起を入れられる設計余裕があるか？**

   * YES → 磁束モデルでも補償可能 （HF／LF 注入を検討）
   * NO  → 電力基準方式の方がシンプル
2. **温度上昇が速い or 長時間ロックが多いか？**

   * YES → 電力基準に温度補正を重ねる案が無難
   * NO  → 前回値ホールドでも許容性能に収まる場合が多い

> **実務 tip**: 多くの量産 EV 駆動では *角度推定* のために HF 注入が既に入っている ⇒ その信号を流用して Δφ 可観測性を確保すれば、ロック域でも磁束補償が可能になります。

---

**結論**

* “磁束モデル＝ロック時に補正不可” は半分正しい。
* しかし **励起を追加すれば可観測性は復活** するため、ハード構成と騒音要件を天秤にかけて採否を決めるのが現実解です。


### 1 ️⃣ “ロック域 Pref を実測マッピング”で消せるもの・残るもの

| 要素                             | Pref を **実測**で登録すると…                    | 運転後に残る誤差源                                           |                             |                                  |
| ------------------------------ | --------------------------------------- | --------------------------------------------------- | --------------------------- | -------------------------------- |
| **鉄損そのもの**<br>(ヒステリシス・渦電流)     | その温度・インバータ周波数条件で **丸ごと吸収**できる           | 温度依存が小さいならほぼゼロ<br>（材料 FeSi のヒステリシス損は ≈ +0.1 %/K 程度） |                             |                                  |
| **デッドタイム／V<sub>drop</sub> 誤差** | 同じ PWM・V<sub>dc</sub> 条件なら Pref に埋め込まれる | V<sub>dc</sub> やパルス幅が変わると再びズレ                       |                             |                                  |
| **位相ずれ (θ̂ 誤差)**               | その時点のずれも含めた P が登録される                    | θ̂ が変動すると P<sub>meas</sub> が動く ⇒ ΔP 発生              |                             |                                  |
| \*\*銅損 (3 R<sub>s</sub>        | I                                       | ²)\*\*                                              | **R<sub>s</sub> の基準温度値**を含む | **R<sub>s</sub>(T)** 上昇分だけ残差に現れる |

**⇒ 結果**
*“鉄損はほぼキャンセル、残る主犯は R<sub>s</sub> 温度ドリフト”* という見立ては概ね正しい。

---

### 2 ️⃣ R<sub>s</sub> 温度ドリフトが補償系に与える大きさ

$$
\Delta P_{cu} = 3\,\Delta R_s\,|i|^2,
\qquad
\Delta T_e^{\text{comp}} = K\,\Delta P_{cu}.
$$

*例* : |I| = 200 A, ΔR<sub>s</sub> = +20 mΩ（+40 % @ +50 K）
→ ΔP<sub>cu</sub> = 3 × 0.02 × 200² ≈ **2.4 kW**
K = 0.015 Nm/W ⇒ ΔT<sub>e</sub> ≈ **36 Nm** （150 Nm 指令の ±24 %）

> **希望はあるか？**
> Yes ― **R<sub>s</sub>(T) を 10 % 精度で追えれば残差トルク誤差は ±3 % 程度**まで抑えられる。
> つまり *温度さえ見えれば* 実用レンジに入る。

---

### 3 ️⃣ 実装アイデアで “希望” を現実にする

| レイヤ                        | 推奨策                                                                                                      | 備考            |                  |                     |
| -------------------------- | -------------------------------------------------------------------------------------------------------- | ------------- | ---------------- | ------------------- |
| **A. Pref テーブル**           | • ω=0・V<sub>dc</sub>一定で<br>  Id/Iq グリッドを掃引し Pref を実測登録<br>• 温度 3 点（例 25 °C / 60 °C / 100 °C）を取って*線形外挿*   | 鉄損・デッドタイムを吸収  |                  |                     |
| **B. R<sub>s</sub>(T) 補償** | • ステータサーミスタ (τ≈2 s) を読む<br>• $R_s(T)=R_{20}(1+α·(T-20))$ (α≈0.0039/K)<br>• ΔP′=P<sub>meas</sub>−3R\_s(T) | I             | ² をフィードバックに使用    | 温度勾配 50 K→誤差 <±5 Nm |
| **C. ゲイン K**               | • 速度依存 K(ω)=K₀·ω/ω\_ref（ω<ω\_min→K=0）<br>• K₀ を「100 ms で 90 % 収束」になるよう同定                                 | ロック近傍はゲイン自動低下 |                  |                     |
| **D. 遅い I 積分**             | ΔP の残留オフセットを τ<sub>I</sub>=2–5 s でゼロ化                                                                    | 長時間停車でも温度追従   |                  |                     |
| **E. 安全クランプ**              | (                                                                                                        | ΔT\_e^{comp}  | ≤ 0.15·T\_{ref}) | 暴走防止                |

---

### 4 ️⃣ まとめ

* Pref をロック域で **実測マッピング**しておけば、鉄損・インバータ誤差は大部分相殺できる。
* **残るのは R<sub>s</sub> 温度ドリフトと位相ずれ**。

  * R<sub>s</sub>(T) を温度モデルで補正＋遅い積分で追従
  * 位相ずれはセンサレス θ̂ 品質の改善 or 低速時に K を下げる
* これらを組み込めば **±5 % 以下のトルク精度**が現実的に達成可能。

> **つまり**：希望は十分あります。鍵は「温度を見て R<sub>s</sub> を動かす」仕組みを Pref‐ΔP ループに組み込むことです。
