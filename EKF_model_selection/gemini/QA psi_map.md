はい、その手法は抵抗`Rs`やデッドタイム等による電圧誤差をキャンセルできるため、オフラインでの磁束マップ作成において非常に有効です。

定常状態の2点のデータから、`φd`と`φq`は以下の式で算出できます。

* **d軸磁束 φd:**
    $$\phi_d = \frac{v_{q1} + v_{q2}}{2\omega}$$
* **q軸磁束 φq (データセット1の動作点における値):**
    $$\phi_{q1} = \frac{v_{d2} - v_{d1}}{2\omega}$$

---
### ## 計算の原理と手順

この計算は、定常状態でのd-q電圧方程式に基づいています。

$$
v_d = R_s i_d - \omega \phi_q \\
v_q = R_s i_q + \omega \phi_d
$$

#### 1. データの準備
まず、2つの動作点のデータを以下のように定義します。

* **データセット1**: `(vd₁, vq₁, id, +iq, ω)`
* **データセット2**: `(vd₂, vq₂, id, -iq, ω)`

この計算が成立するための前提は以下の通りです。
* 2つの測定間で`Rs`, `ω`は一定である。
* `φd`は`iq`の偶関数であるため、`φd(id, +iq) = φd(id, -iq)`。
* `φq`は`iq`の奇関数であるため、`φq(id, -iq) = -φq(id, +iq)`。
* デッドタイム等による電圧誤差`Δv`は電流の符号に依存し、`Δv(+iq) = -Δv(-iq)`。

#### 2. φdの算出
`vq`の式を2つのデータセットで立てます。

* `vq₁ = Rs * (+iq) + ω * φd + Δv_err`
* `vq₂ = Rs * (-iq) + ω * φd - Δv_err`

この2式を足し合わせると、`Rs`の項と電圧誤差`Δv_err`の項が打ち消し合います。

$$v_{q1} + v_{q2} = (R_s i_q + \omega\phi_d + \Delta v_{err}) + (-R_s i_q + \omega\phi_d - \Delta v_{err}) = 2\omega\phi_d$$

これを`φd`について解くと、最初の式が得られます。

#### 3. φqの算出
同様に`vd`の式を立てます。`φq`は`iq`の符号で反転することに注意します。

* `vd₁ = Rs * id - ω * φq₁`
* `vd₂ = Rs * id - ω * (-φq₁) = Rs * id + ω * φq₁`

今度は**式2から式1を引き算**することで、`Rs`の項を消去します。

$$v_{d2} - v_{d1} = (R_s i_d + \omega\phi_{q1}) - (R_s i_d - \omega\phi_{q1}) = 2\omega\phi_{q1}$$

これを`φq₁`について解くと、目的の式が得られます。