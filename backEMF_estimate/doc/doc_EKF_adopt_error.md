はい、承知いたしました。ご依頼いただいた技術文書を以下に翻訳しました。専門用語の正確性と文脈の整合性を重視し、理解しやすいように整理してあります。

-----

### **EKFベース磁束推定におけるデッドタイム、電圧降下、センサ誤差を補償するアプローチ**

#### **はじめに・背景**

IPM（永久磁石埋込型）モータ用の拡張カルマンフィルタ（EKF）磁束推定器は、電圧モデル（電圧$v$と電流$i$から磁束を積分）と電流モデル（測定電流からルックアップマップを介して磁束を算出）をハイブリッドなオブザーバ内で組み合わせることができます。予測ステップでは、連続時間系の磁束鎖交数の微分方程式（例：$d\\boldsymbol{\\phi}/dt = \\boldsymbol{v} - R\_s \\boldsymbol{i} \\pm \\omega\_e \\boldsymbol{\\phi}$）が積分されます。これは本質的に古典的な電圧モデルです。補正ステップでは、測定された相電流 $(i\_d, i\_q)$ を、モータの$i$-$\\phi$特性を表す磁束マップ $\\phi\_{\\text{map}}(i\_d, i\_q)$ と比較し、磁束推定値を調整します。このEKFの「電圧＋電流」ハイブリッドアプローチは、両モデルの長所を活かします。つまり、電圧モデルが良好な動的応答を提供し、電流ベースの更新が長期的なドリフトを補正します。

しかし、インバータやセンサの非理想性は、予測と補正の両ステップでバイアスや誤差を発生させる可能性があります。これらには以下が含まれます。

  * **インバータ電圧のデッドタイムと素子の電圧降下**（指令電圧と実際の印加電圧の間に差異を生じさせる）
  * **相電流センサの誤差**（$i\_a, i\_b, i\_c$ の測定におけるオフセットやスケーリング誤差）
  * **その他のインバータ電圧誤差**（例：DCリンク電圧測定誤差やPWMの非線形性）

これらの要因を考慮しない場合、磁束推定誤差、ひいてはトルク推定誤差につながります。（BEV用のIPMのような）駆動モータでは、正確なトルク制御が極めて重要であるため、これらの影響を軽減する戦略が必要です。以下では、各誤差要因とEKFベース磁束推定器における補償アプローチについて議論します。

-----

### **EKFモデルにおけるデッドタイムと電圧降下の補償**

#### **影響**

インバータのデッドタイム（短絡を避けるためにスイッチング素子間に設けられる短い遅延）と、トランジスタやダイオードにおける電圧降下は、指令電圧と実際の相電圧との間に不一致を引き起こします。その結果、平均出力電圧はわずかに低下し、歪みます。この偏差は通常、DCリンク電圧の1～5%程度です。高速域や高電圧域ではこれはごく一部ですが、低速域では必要な基本波電圧が小さいため、デッドタイムに起因する誤差が指令電圧に匹敵するほど大きくなる可能性があります。これにより、重大な磁束推定誤差が生じます。EKFの予測ステップは実際よりも高い電圧を積分してしまい、推定磁束がドリフトする原因となります。実験によれば、デッドタイムを補正しないと、センサレスオブザーバは大きな位置推定誤差に見舞われたり、低速域で制御不能に陥ったりする可能性があります。したがって、デッドタイムと素子の電圧降下を補償することは、低速域における精度と安定したトルク制御のために不可欠です。

#### **補償アプローチ**

EKF磁束推定器でデッドタイムと電圧降下に対処するための一般的な戦略は、「失われた」電圧に対する補正をモデルに導入することです。効果的なアプローチには以下のようなものがあります。

1.  **モデルベースの電圧バイアス補償:** デッドタイム（およびトランジスタの電圧降下）による予測されるステータ電圧誤差を計算し、これをEKFの予測モデルで使用される電圧にバイアスとして加えます。例えば、電流の極性と大きさに基づいて、各PWMサイクル中の平均的な電圧損失を表す電圧オフセット $\\Delta u\_d, \\Delta u\_q$ を推定できます。従来のデッドタイム補償アルゴリズムは、このような式（多くは電流の向きを知る必要がある）を用い、電圧偏差（例：$V\_{dc}$の数パーセント）を指令電圧リファレンスに加算します。実際には、これは相電流の関数としての$\\Delta u$のルックアップテーブルや式を含む場合があります（誤差は通常、電流が還流するオフ期間中に$\\pm V\_{\\text{drop}}$となるため）。EKFに $v\_{\\text{effective}} = v\_{\\text{command}} + \\Delta u$ を入力することで、磁束の積分は実際の磁束変化により近くなります。

2.  **オブザーバ内での補償（ハイブリッドオブザーバ）:** インバータの出力を変更するのではなく、オブザーバ（EKF）の内部でのみ電圧を補正する方が、より単純で安全なアプローチです。言い換えれば、デッドタイムによる電圧降下は、実際の制御PWMには加えず、EKFの状態予測におけるステータ電圧にのみ加算します。これは「拡張磁束オブザーバ」センサレス制御システムで用いられる戦略です。補償をEKFモデル内に限定することで、補償の潜在的な過補償が実機のモータ駆動を不安定にすることを防ぎます。補償におけるわずかな誤差はオブザーバにのみ影響し、EKFの電流フィードバックが残差磁束誤差を補正できます。実際、同時に行われる電流モデルによる更新のおかげで、拡張磁束オブザーバはデッドタイム電圧推定のわずかな不正確さに対して寛容です。このハイブリッドアプローチは、特に電流測定精度が限定的な場合に、開ループの電圧補正よりもロバストです。

3.  **適応型/EKFベースのデッドタイム推定:** 高精度を求める場合、EKF自体を拡張してデッドタイム効果を適応的に推定することができます。一つの方法は、未知の電圧誤差を状態変数の一部として含めるか、補助的なオブザーバを使用することです。デッドタイムによって引き起こされる外乱電圧や高調波成分を推定するために、EKFやカルマンフィルタを使用する研究が提案されています。例えば、EKFは相電流をフィルタリングして、デッドタイム補償ロジックにとって重要なゼロクロス時点を確実に検出できます。EKFによるリアルタイムの電流推定値は、センサがノイズを含んでいても電流の極性を判断するのに役立ち、従来のデッドタイム補償を悩ませるゼロ近傍での電流符号の曖昧さの問題を回避します。信頼性の高い電流極性と大きさがあれば、適応型デッドタイム補償器は$\\Delta u$をオンラインで調整できます。いくつかの高度な手法では、デッドタイム電圧を外乱として扱い、適応オブザーバを用いてリアルタイムで推定することで、素子特性の正確な事前知識なしに必要な補償を効果的に学習します。

\<br\>
図：EKFベース磁束オブザーバとデッドタイム補償を備えたセンサレス制御システム（IPMSM）の構成。このハイブリッド構成では、拡張磁束オブザーバ（EKF）は電圧モデルと電流モデルの両方を使用し、デッドタイム補正ブロックが電圧偏差 $(\\Delta u\_d, \\Delta u\_q)$ を計算して、オブザーバの予測モデルへのステータ電圧入力を調整します。測定された電流 $(i\_d, i\_q)$ は、引き続きEKFの補正更新に使用されます。デッドタイム補償をオブザーバ内に限定することで、補償誤差によって全体のベクトル制御が不安定になることはありません。このアプローチは、ロータ位置とトルク推定の信頼性を大幅に向上させます。実験では、完全なデッドタイム補償によって電流がはるかに滑らかになり、トルクがより正確になることが示されています。例えば、デッドタイム補償がない場合、起動時のピーク相電流は約2倍になり、負荷がかかった状態ではモータが起動に失敗しました。適切な補償を行うことで、特に低速域において、デッドタイムに起因するトルクリップルと位置誤差が大幅に低減されます。

-----

### **相電流センサ誤差の補償**

#### **影響**

EKFは、磁束推定値を補正するために（磁束/電流マップを介して）相電流測定値を使用します。電流検出におけるいかなる誤差（例：DCオフセット、ゲイン誤差、位相不整合）も、直接的に不正確な磁束補正につながります。一般的な問題は電流センサのオフセット（測定電流の一定のバイアス）で、これはセンサのハードウェア（例：ホール効果センサのバイアスやシャント測定におけるADCオフセット）から生じ、温度や経年でドリフトする可能性があります。$i\_d$や$i\_q$のわずかなオフセットでさえ、EKFが電流の不一致を解消するためにバイアスのかかった磁束推定値に収束する原因となり、定常状態でのトルク誤差や振動を引き起こします。例えば、相電流のオフセットは、基本波周波数でのトルクリップルや出力トルクのバイアスを生成する可能性があります。なぜなら、コントローラが認識された誤差を相殺するために逆のトルクを注入するかもしれないからです。同様に、電流センサのスケーリング（ゲイン）誤差（例：5%高く読み取る）は、EKFの電流モデルに磁束が実際よりも高いと誤認させ、結果として磁束の過小評価につながる可能性があります。したがって、センサ誤差の補償は、正確なトルク計算と、閉ループ制御における積分器のワインドアップや不安定性を防ぐために重要です。

#### **補償アプローチ**

モータ制御システムにおける電流センサ誤差に対処するための確立された手法があり、これらはEKFベースの磁束オブザーバにも適用できます。

1.  **初期オフセット校正:** 最も簡単なアプローチは、電流がゼロであることが分かっている状態で、電流センサの固定オフセットを測定して除去することです。例えば、システム起動時（モータが停止し電流が流れていない状態）には、各相センサの読み取り値は理想的にはゼロであるべきです。ゼロでない読み取り値はオフセットとして保存され、その後の測定値から差し引かれます。このオフライン校正ステップは、一定のバイアスに対処します。多くのドライブは、温度ドリフトを考慮して、定期的にオフセットを再校正します（例えば、モータが安定したアイドル状態にあるとき）。これにより、EKFにはバイアスのない電流測定値が供給されます。ハードウェア設計によってもオフセットドリフトを軽減できます（例：高精度オペアンプやオートゼロ回路の使用）。引用された一手法は、センサのフロントエンドに温度補償回路を追加することで、温度に対するオフセットを安定させました。（ただし、このようなハードウェア修正は、センサの供給電圧変動など他の原因を見落とす可能性があるため、ソフトウェア補償は依然として有用です。）

2.  **オンラインオフセット推定（オブザーバベース）:** 時間とともに変化するオフセットに対処したり、手動での校正を避けたりするために、EKFを拡張してセンサバイアスをリアルタイムで推定することができます。一つの方法は、状態ベクトルにバイアス項（例：$\\Delta i\_d, \\Delta i\_q$）を追加して、電流測定値のDCオフセットをモデル化することです。EKFはその後、電圧モデルと電流モデルの間の冗長性を利用して、これらのバイアス状態をゆっくりと調整できます。本質的に、オブザーバが測定電流と磁束推定から予測される電流との間に一貫して小さな偏差を観測した場合、それをオフセットに起因するものとして補正することができます。もう一つの実用的なアプローチは、専用の適応オブザーバや積分器を使用することです。例えば、PI型オブザーバは、期待される電流と測定された電流の差を積分して、オフセット値に収束させることができます。研究によれば、このようなオンラインでの誤差観測と補償は、電流センサのオフセットによって引き起こされるトルク脈動を効果的に抑制できることが実証されています。言い換えれば、アルゴリズムが相電流の微小なDC成分や不平衡を検知して差し引くことで、センサバイアスに対するループを閉じます。EKFやオブザーバがオフセット（例：A相で+0.3A、B相で-0.3Aなど）を特定すれば、その補償をリアルタイムで測定値に適用でき、それによって磁束推定器が誤った方向に導かれるのを防ぎます。この方法は、動作中に発生する可能性のある、ゆっくりと変化する、または断続的なオフセット障害に対して特に価値があります。システムは適応し、正確なトルク推定を維持できます。

3.  **ゲイン誤差とスケーリング補正:** 電流センサにゲイン誤差（例：全範囲にわたって5%高く、または低く読み取る）がある場合、磁束推定への影響は少し微妙です（EKFにインダクタンスや磁束鎖交数が異なると誤認させる可能性があります）。ゲイン誤差も通常、オフライン校正によって対処されます。例えば、既知の電流をセンサに流す（またはメーカーの校正データを使用する）ことで、正しいスケーリングを設定します。EKFの文脈では、ゲイン誤差の推定はより困難ですが（乗算的な要素になるため）、必要であれば最小二乗法や拡張オブザーバのような技術を使用できます。実際には、現代のセンサは十分に正確であるため、一度の校正で十分な場合が多いです（数パーセントのゲイン誤差は許容されるか、制御の調整で補償されることがあります）。極度の精度が必要な場合は、ゲインを（モータ定数のパラメータ推定と同様に）同定すべきパラメータとして扱い、EKFの測定モデルをそれに応じて調整することもできます。

4.  **冗長な測定とチェック:** 別のアプローチとして、三相システムの固有の冗長性を利用する方法があります（3つの電流センサが存在する場合）。Y結線の三相PMSMでは、常に $i\_a + i\_b + i\_c = 0$ が成り立ちます（測定ノイズを無視した場合）。3つすべてのセンサがあれば、$i\_a + i\_b + i\_c = 0$ であるかを継続的にチェックできます。偏差（特にDC偏差）は、1つ以上のセンサにオフセットがあることを示します。これをアルゴリズム化して、オフセットを適切な相に割り当ててキャンセルすることができます。2つのセンサしかない場合（3つ目は計算で求める一般的なケース）でも、計算された3番目の電流と実際の電流（もし時々測定しているか、特定の条件下で）を比較することで、オフセットを検出できます。これらの方法は、EKFのバックグラウンドで実行して、センサの読み取り値を整合させ続けることができます。

要約すると、相電流センサの誤差は通常、校正と適応フィルタリングの組み合わせによって処理されます。高性能なEV駆動システムでは、オフセットやドリフトが最小限の高品質なホール効果センサが使用されることが多く、問題は単純化されます。しかし、コスト重視のシステムでシャント抵抗を電流検出に使用する場合（小型モータや補助駆動装置で時々見られる）、低電流域での精度が低下し、オフセットが顕著になります。そのような場合には、上記のようなオンラインオフセット補償を実装することが非常に有益です。EKFへの電流測定値が信頼できる（ゼロバイアスで正しくスケーリングされている）ことを保証することで、磁束オブザーバは電流を正しく磁束にマッピングでき、結果としてセンサ誤差によるトルクリップルを最小限に抑えた正確なトルク推定が可能になります。

-----

### **インバータ電圧の測定およびモデリング誤差**

#### **影響**

デッドタイムや素子の電圧降下以外にも、インバータの出力電圧に関連する他の誤差が磁束推定に影響を与える可能性があります。これらには、DCリンク電圧センサの不正確さ、PWM波形の歪み、電圧指令のタイミングや計算誤差などが含まれます。例えば、DCバス電圧が不正確に測定された場合（仮にADCが5%高く読み取ったとします）、EKFに入力される指令電圧 $v\_d, v\_q$ （ボルト単位）は5%大きくなります。これは電圧入力におけるゲイン誤差に似ており、EKFが磁束変化を過大に予測する原因となり得ます。さらに、制御ループの遅延やPWMの量子化は、想定される印加電圧と実際の電圧との間に小さな差を生み出す可能性があり、これはEKFの観点からはモデル化されていないダイナミクスやノイズとして作用します。これらの誤差は一般的にデッドタイム効果よりも小さいですが、対処しないと、特に過渡時や回生時（低電圧での精密な電圧モデリングが必要な場合）に蓄積したり、オブザーバを乱したりする可能性があります。

#### **アプローチ**

インバータ電圧誤差への対処には、校正とロバストなオブザーバ設計の両方が含まれます。

1.  **DCリンクセンサの校正とフィルタリング:** 計算で使用されるDCリンク電圧 ($U\_{dc}$) が正確であることを保証します。これは、電圧センサを既知の基準に対して校正することで行うことができます（多くのインバータには、分圧器用のADCゲイン/オフセットを校正するルーチンがあります）。さらに、$U\_{dc}$測定値から高周波ノイズをフィルタリングすることで、急激な変動（例：電流リップルによるもの）が誤った値をEKFに供給するのを防ぎます。BEVでは、バッテリ電圧は負荷によって変動する可能性がありますが、そのダイナミクスはPWMに比べて遅いです。指令相電圧を計算するために、フィルタリングされた、または平均化された$U\_{dc}$を使用することで十分な場合が多いです。目標は、想定される供給電圧における系統的な誤差を排除することです。

2.  **電圧の不確かさに対するプロセスノイズの組み込み:** EKFのフレームワークでは、プロセスノイズ共分散を調整することで、モデルの不確かさを考慮することができます。モデルに入力されるインバータ電圧に何らかの誤差（PWMの非線形性、モデル化されていない高調波などによる）があると疑われる場合、電圧の影響の一部をプロセスノイズとして扱うことができます。実際には、これは電圧モデルを過信しないことを意味します。EKFに少し高めのプロセスノイズを与えることで、電流測定値を用いてより迅速に磁束を補正できるようにします。本質的に、EKFには「$d\\phi/dt = v - R i \\pm \\omega \\phi$ という我々のモデルは正確ではないので、電流フィードバックが不一致を示したときには磁束推定値を調整する準備をしておくように」と伝えます。こうすることで、電圧の小さな定常誤差（一貫して1%の過電圧など）が磁束の暴走的なバイアスにつながることはありません。なぜなら、EKFが継続的にそれをトリミングするからです。これは、モデル誤差が存在する中で安定性と引き換えに帯域幅を犠牲にする、ロバストな設計アプローチです。

3.  **拡張電圧バイアス状態:** より明示的な補償のために、EKFを拡張して印加電圧の任意の一定誤差を推定することもできます。電流バイアス状態を追加するのと同様に、例えば、電圧の未知の一定オフセットを表す状態 $\\Delta u\_d$ と $\\Delta u\_q$ を追加することができます。これらの状態変化は非常にゆっくり変化する（または一定）とモデル化し、EKFは予測電流と観測電流の間の長期的な誤差を用いて$\\Delta u$を調整します。例えば、磁束オブザーバが一貫して、測定された$i\_q$が推定された$\\phi\_q$に対して期待されるよりも低いと観測した場合、それは有効な$u\_q$が指令値よりも低い（つまり、負の$\\Delta u\_q$）ことに起因すると考えるかもしれません。時間をかけて、それは小さなバイアス値に収束する可能性があります。一度特定されれば、このバイアスは（デッドタイムが処理されたのと同様に）補正としてフィードバックできます。このアプローチは、インバータの真のゲインや任意の固定誤差を効果的に学習します。しかし、これはEKFの状態次元と複雑さを増加させるため、設計上の選択となります。バイアスが相当なものでない限り、プロセスノイズの調整のようなより単純な方法が好まれることが多いです。

4.  **PWM非線形性補償:** それほど一般的ではありませんが、PWM生成に既知の非線形性がある場合（既に説明したデッドタイム歪みや、SVPWMのゼロシーケンス挿入におけるわずかな偏差など）、それらをモデル化することができます。例えば、一部のコントローラは、デッドタイムを打ち消すために意図的にデューティサイクルをオフセットさせることがあります（フィードフォワードの一形態）。EKFのモデルは、実際のインバータで使用されるそのような戦略を反映すべきです。現代のドライブではこれらの影響は通常小さいですが、それらを認識することでオブザーバの精度を高めることができます。

要約すると、インバータ電圧誤差は、良好な校正と、EKFを小さな不一致に対してロバストにすることによって対処されます。ハイブリッドEKF（電圧＋電流）は本質的に寛容です。たとえ電圧モデルが完全でなくても、電流フィードバックが磁束を補正します。重要なのは、大きな系統的誤差がないことを確認することです。センサ（電圧と電流）を校正することでバイアスが除去され、EKFの設計パラメータを用いてモデルの不確かさを考慮することで残りが処理されます。実用的なBEVのIPMモータシステムでは、前述のデッドタイム補償とセンサオフセット修正を適用した後、残りの電圧誤差は通常軽微です。多くの実装では、EKFが補正なしで電圧予測に基づいて長時間オープンループで動作しないように、単に少し保守的なチューニングを施すだけです。

-----

### **オンライン補償 vs. オフライン補償戦略**

これらの誤差要因に対して、オンラインの適応的補償と、固定されたオフライン校正の戦略について言及する価値があります。両アプローチは、最適なパフォーマンスのために組み合わせることができます。

  * **オフライン（固定）補償:** これは、管理された環境で誤差値を測定または決定し、それらをシステムの定数としてプログラムすることを含みます。例えば、様々な電流でデッドタイム効果を測定し、補償テーブルを固定する、起動時に電流センサのオフセットを測定する、IGBTの電圧降下にはメーカーデータを使用するなどです。オフライン手法（設置時に自動的に行われる場合は自己コミッショニングとも呼ばれる）は、既知の非線形性を考慮に入れることができます。利点は実行時の単純さです。EKFは事前に決められた補正を適用するだけです。欠点は、条件が変化した場合（素子の経年劣化、極端な温度など）、固定された値が最適でなくなる可能性があることです。

  * **オンライン適応補償:** これは、オブザーバやEKFの拡張機能を使用して、動作中に誤差を継続的に推定します。議論したように、デッドタイム電圧、センサオフセットなどのために状態を拡張したり、別のオブザーバを使用したりすることができます。デッドタイム補償をリアルタイムで適応的に調整する、高度なカルマンフィルタベースの手法が提案されています。利点は、システムが変化（例：温度変化に伴うセンサバイアスの増加や、DCリンク電圧の読み取り値のドリフト）を追跡できることです。実際、文献によれば、オブザーバベースの適応型デッドタイム補償器は、様々な条件下で非常に正確な結果を達成できることが示されています。しかし、多くの適応ループを稼働させ続けると、コントローラが複雑になり、相互作用のリスクが生じる可能性があります。したがって、実用的なアプローチは、最初は適応型で、その後は固定型にすることが多いです。

賢明な戦略は\*\*「オンラインでの校正、その後のオフラインでの適用」\*\*です。このアプローチでは、EKFまたは関連するアルゴリズムが、起動時または校正フェーズ中に補償項を調整・学習することが許可されます。例えば、動作の最初の数秒間（または専用の校正ルーチン中）に、EKFは「インバータの有効電圧は期待値より3%低い」「A相電流センサには+0.2Aのオフセットがある」といった値を推定するかもしれません。これらの値が収束すると、システムはそれらをロックインし（定数補償として使用）、通常運転中はオブザーバを単純化するために適応推定をオフにすることができます。こうすることで、継続的な適応のノイズや複雑さなしに、オンライン識別の精度を得ることができます。一部のシステムでは、定期的な再校正さえも行います。例えば、車両が惰性走行しているときや停止しているときに、オフセットを迅速に再推定し、長期的な精度を確保します。

結論として、IPMモータ駆動におけるEKF磁束オブザーバを用いたトルク補償は、インバータとセンサの非理想性を慎重に取り扱う必要があります。デッドタイム/電圧降下の補償項を追加し、センサバイアスを補正し、電圧検出誤差に対処することで、EKFは正確な磁束推定を維持できます。これにより、正確なトルク計算が可能になります（IPMのトルクは $\\lambda\_d, i\_q$ と $\\lambda\_q, i\_d$ から計算できるため）。これらの補償を、適切に調整された固定値、適応推定（または両者の組み合わせ）のいずれかを通じて実装することで、駆動性能は大幅に向上します。その結果、インバータの非線形性やセンサの不完全性といった実世界の問題に直面しても、より信頼性が高く滑らかなトルク出力が得られます。このようなロバストなアプローチは、現代のEV駆動において、全動作範囲にわたる安定性と精度を確保しながら、EKFベースのセンサレス（またはエンハンスト）オブザーバによる高性能なトルク制御を達成するために実際に使用されています。

*出典：これらのアプローチを裏付けるために、PMSM駆動用のハイブリッドEKFオブザーバ、デッドタイム効果の分析と補償方法、電流センサ誤差補償技術、インバータ非線形性に対する適応オブザーバ戦略など、最近の文献や実験的研究を参照しました。これらは、トルク推定精度の向上におけるオンラインおよびオフライン補償の有効性を示しています。全体的なアプローチは、古典的な制御工学の実践（校正とフィードフォワード補正）と現代の推定理論（EKF適応）を組み合わせ、実用的なIPMモータインバータシステムにおいてEKFベースの磁束モデルが正確であり続けることを保証します。*