

# **不確実性を乗り越える：カルマンフィルタへの包括的かつ直感的なガイド**

## **第1部：推定における根本的な課題：なぜカルマンフィルタが必要なのか**

### **1.1 はじめに：ノイズの多い世界における「真の状態」の探求**

我々の世界は、本質的に不確実性に満ちています。工学、経済学、ロボット工学、航法システムなど、多くの分野でシステムの正確な「状態」（例えば、位置、速度、温度、電圧など）を知ることが極めて重要です。しかし、この「真の状態」を直接、完璧に観測することはほとんど不可能です。我々が利用できるのは、センサーや測定機器から得られる間接的で、常に何らかの誤差（ノイズ）を含んだ情報だけです 1。

この根本的な課題に対処するために、数多くの技術が開発されてきました。その中でも、ルドルフ・E・カルマンが1960年に発表したアルゴリズムは、画期的な解決策を提示しました 2。今日、カルマンフィルタとして知られるこの手法は、現代技術の根幹をなす、最も強力で広く利用されている推定アルゴリズムの一つです。

その応用範囲は驚くほど広く、具体的な例を挙げることでその重要性がより明確になります。

* **自律航法**: 自動運転車は、自身の正確な位置と速度を常に把握する必要があります。しかし、GPSには数メートルの誤差があり、車輪の回転数から位置を推定するオドメトリはタイヤのスリップによって誤差が蓄積し、慣性計測装置（IMU）は時間とともにドリフト（ずれ）が生じます 3。カルマンフィルタは、これらの不完全でノイズの多い複数の情報源をリアルタイムで融合し、単一の、より高精度な状態推定値を生成する役割を担います 3。  
* **航空宇宙と防衛**: カルマンフィルタがその名を馳せた最初の応用例の一つが、アポロ計画における宇宙船の軌道推定でした。地上からのレーダー観測にはノイズが避けられず、宇宙船の正確な位置と速度を推定するためにこのフィルタが不可欠でした 5。現代においても、レーダーが敵機を追跡するシナリオを考えてみましょう。レーダーの測定値には大気の影響による誤差が含まれるだけでなく、ターゲットである航空機は風やパイロットの操縦によって予測不能な動きをします 2。カルマンフィルタは、このような測定誤差とターゲットの予測不能な挙動の両方を考慮に入れ、追尾性能を劇的に向上させます。

これらの例に共通する中心的なテーマは、カルマンフィルタが、システムの振る舞いを記述した「予測モデル」と、ノイズを含んだ一連の「実測値」を巧みに組み合わせることで、直接観測できない隠れた状態の最良推定値を導き出すアルゴリズムであるということです 3。本稿では、この強力なツールの基本的な考え方から、その数学的な核心、そして実際の応用までを、包括的かつ直感的に解説していきます。

### **1.2 基礎的なアナロジー：湖の魚の数を推定する**

カルマンフィルタの直感的な理解を助けるために、ある比喩を用います。これは、ユーザーが分かりやすいと感じた「湖にいる魚の数」を推定する問題です 5。

* **隠れた「状態」（x）**: これは、我々が本当に知りたいけれど、直接見ることはできない量です。この例では、「湖に生息する魚の真の総数」がこれにあたります。この値は時間とともに変動する可能性があります。  
* **不完全な「観測値」（z）**: これは、我々が実際に手に入れることができるデータです。この例では、「ある日に釣り上げた魚の数（釣獲尾数）」が観測値となります。この釣獲尾数は、湖の魚の総数を反映しているかもしれませんが、完全な情報ではありません。釣り人の腕前、その日の天候、使った餌の種類、あるいは単なる運など、多くの要因によって左右されます 5。

このアナロジーの重要な点は、「知りたいこと（状態）」と「見ることができるもの（観測値）」を明確に区別することです。カルマンフィルタの目的は、不完全な「観測値」である釣獲尾数から、直接は見えない「状態」である湖の魚の真の数を、可能な限り正確に推定することにあります。

### **1.3 不確実性の分解：二つの敵**

カルマンフィルタが非常に強力である理由の一つは、不確実性を一つの大きな問題として扱うのではなく、その起源に基づいて二つの異なる種類に明確に分解してモデル化する点にあります。この二つの「敵」を理解することが、フィルタの動作原理を把握する鍵となります。再び、湖の魚のアナロジーを用いてこれらを具体化してみましょう。

* **プロセスノイズ（w）**: これは、システムモデル自体の不確実性を指します。湖の魚の数は、我々の予測モデルが完全には捉えきれない要因によって変動します。例えば、新たな魚が生まれたり、病気で死んだり、あるいは川を通じて他の水域へ移動したりするかもしれません。これらは、魚の総数という「状態」が時間とともに変化する際の、予測不可能な変動要素です。車両の例で言えば、これは突風、路面の凹凸、エンジン出力の微細な変動といった、モデル化されていない力に相当します 2。プロセスノイズは、ある時刻から次の時刻へと状態が遷移する際の不確実性を表し、その大きさは  
  **プロセスノイズ共分散行列 Q** によって定量化されます。  
* **観測ノイズ（v）**: これは、測定プロセスにおける不確実性を指します。釣獲尾数という観測値はノイズを含んでいます。たくさん釣れた日があったからといって、必ずしも湖が魚で溢れているとは限りませんし、逆に一匹も釣れなかったからといって、湖が空っぽであるとは断定できません。これは測定に伴うランダムなばらつきです。レーダーの例では、大気中の電波干渉や、受信機の持つ固有の精度限界などが観測ノイズの原因となります 2。観測ノイズは、個々の測定における不確実性を表し、その大きさは  
  **観測ノイズ共分散行列 R** によって定量化されます。

カルマンフィルタの核心的な機能は、単にデータを平滑化（スムージング）すること以上のものです。それは、これら二つの異なる起源を持つ不確実性を積極的に管理することにあります。フィルタは、プロセスノイズ Q と観測ノイズ R という形で、これらの不確実性を明確に分離してモデル化します。この分離こそが、その有効性の鍵です。もしフィルタが観測ノイズしか考慮しなければ、システムの真の変化に追従するのが遅れてしまいます。逆に、プロセスノイズしか考慮しなければ、ノイズの多い測定値一つ一つに過敏に反応しすぎてしまうでしょう。

結論として、カルマンフィルタの第一の機能は、洗練された「不確実性管理者」であると言えます。それは、自身の推定値がどれほど不確かであるかを定量的に追跡し（後述する誤差共分散行列 P を用いて）、プロセスモデルの不確実性 (Q) と観測の不確実性 (R) の既知の特性を利用して、モデルに基づく予測と現実世界の測定値との間で最適な仲裁を行うのです。

## **第2部：アルゴリズムの核心：予測と修正の周期的サイクル**

### **2.1 二段階のリズム：予測と更新**

カルマンフィルタの動作原理は、非常にエレガントな「予測」と「更新」という二つのステップを絶え間なく繰り返す、リズミカルなサイクルに基づいています 1。この再帰的なループが、フィルタの心臓部です。

このアルゴリズムの重要な特徴の一つは、それが**オンラインアルゴリズム**であるという点です。これは、過去の全ての測定値を保存しておく必要がなく、新しい測定値が到着するたびに逐次的に処理を行うことを意味します 3。この特性により、カルマンフィルタはリアルタイム性が要求されるアプリケーション（例えば、ロボットのナビゲーションや金融市場の分析）にとって理想的なツールとなっています。

このサイクルは以下のように構成されます。

1. **予測 (Prediction)**: 前の時刻の推定結果に基づき、現在の時刻の状態がどうなっているかを「予測」する。  
2. **更新 (Update)**: 新たに得られた現在の時刻の「観測値」を使い、予測した値を「修正（更新）」して、より確からしい推定値を得る。

この予測と更新のサイクルを繰り返すことで、フィルタは不確実性の中で最も可能性の高い状態を追跡し続けます。

### **2.2 予測ステップ（時間更新）：教育された推測**

予測ステップは、システムに関する我々の知識（物理モデルや運動方程式など）を用いて、未来を推測するプロセスです。

* **ステップの内容**: フィルタは、前の時刻（k−1）における最良の推定値と、システムのダイナミクスを記述するモデル（状態方程式）を用いて、現在の時刻（k）の状態がどこにあるかを予測します。これは、過去の情報に基づいた「教育された推測（educated guess）」です 2。例えば、走行中の自動車について、「0.1秒前の位置と速度が分かっていれば、次の0.1秒後にはここにいるだろう」と予測するようなものです。この予測された状態は  
  **事前推定値**（a priori estimate）と呼ばれ、x^k−​ のように表記されます。  
* **もう一つの重要な予測**: 状態そのものを予測するだけでなく、フィルタは自身の推定の不確実性も予測します。時間が経過し、予測不可能な「プロセスノイズ」がシステムに影響を与えた結果、推定値に対する我々の信頼度は低下します。つまり、推定の不確実性は**増大**します。この不確実性は**事前誤差共分散行列** Pk−​ によって表現され、このステップで更新（増大）されます。このプロセスは、いかなる予測も本質的に不確実性を伴うという現実をアルゴリズムに組み込むための、極めて重要なステップです。

### **2.3 更新ステップ（観測更新）：証拠による修正**

更新ステップでは、現実世界からの新しい証拠、すなわち最新の観測値を取り込み、予測ステップで行った推測を洗練させます。

* **ステップの内容**: フィルタは、現在の時刻（k）にセンサーから得られた新しい観測値 zk​ を用いて、予測ステップで得られた事前推定値 x^k−​ を修正します 2。  
* イノベーション（Innovation）: 更新プロセスの核心は、イノベーションまたは残差と呼ばれる量です。これは、実際の観測値 zk​ と、事前推定値から予測される観測値（Hx^k−​）との差で計算されます。  
  イノベーション=zk​−Hx^k−​

  この値は、観測値に含まれる「驚き」や「新しい情報」の量を表しています 1。もし観測値が予測と完全に一致すればイノベーションはゼロとなり、新しい情報は何もないことを意味します。  
* **推定値の洗練**: フィルタは、このイノベーションに後述するカルマンゲインを掛け合わせたものを、事前推定値に加えることで、状態推定値を更新します。これにより、より現実に即した**事後推定値**（a posteriori estimate）x^k​ が得られます。  
* **不確実性の減少**: 観測という新しい情報を取り込むことで、フィルタの推定値に対する信頼度は**向上**します。その結果、推定の不確実性を表す誤差共分散行列 Pk​ は**減少**します。

このアルゴリズムの動作は、「呼吸するアルゴリズム」として視覚化することができます。フィルタの不確実性を表す誤差共分散 P が、まるで呼吸のように膨らんだり縮んだりするのです。**予測ステップ**では、時間が経過し、システムが進化する過程でプロセスノイズ Q が加わるため、我々の推定はより不確かになります。その結果、P は**増大**します（不確実性を吸い込む）。続く**更新ステップ**では、観測値 zk​ から新しい情報を得ることで、我々の推定はより確かなものになります。その結果、P は**減少**します（不確実性を吐き出す）。

この、P が増大し、そして減少するというリズミカルなサイクルこそが、カルマンフィルタの根源的なダイナミクスです。それは、時間の経過によってもたらされる不確実性（プロセスノイズ）と、新しい証拠によって得られる確実性（観測）との間の、絶え間ない綱引きなのです。

## **第3部：カルマンゲイン（K）：信頼の最適仲裁者**

### **3.1 バランス調整：観測値をどれだけ信頼すべきか？**

もしカルマンフィルタの予測と更新のサイクルが心臓部であるならば、その「頭脳」にあたるのが**カルマンゲイン**（K）です 3。カルマンゲインは、単なる固定されたパラメータではありません。それは、フィルタが動作する

**各時刻において、最適に計算される動的な値**です。

カルマンゲインの役割は、新しい観測値と、フィルタ自身の予測値のどちらをどれだけ信頼するかを決定する重み付け係数として直感的に理解できます 3。

* **高いゲイン（K→1 に近い値）**: フィルタの予測が非常に不確かである場合（つまり、事前誤差共分散 P− が大きい）、あるいは、センサーによる観測が非常に信頼できる場合（つまり、観測ノイズ R が小さい）、カルマンゲインは高い値を取ります。この状況では、フィルタは自身の不確かな予測を大きく修正し、観測値に近い値を新しい推定値として採用します。これは、「自分の予測には自信がないが、センサーは信頼できるので、センサーの言うことを重視しよう」という判断に相当します。  
* **低いゲイン（K→0 に近い値）**: 逆に、フィルタの予測に非常に自信がある場合（P− が小さい）、あるいは、観測が非常にノイズまみれである場合（R が大きい）、カルマンゲインは低い値を取ります。この場合、フィルタはノイズの多い観測値をほとんど無視し、自身の予測を維持しようとします。これは、「自分の予測にはかなり自信がある一方、センサーの値はあてにならないので、今回は予測を信じよう」という判断です。

この、予測の不確かさと観測の不確かさのバランスを動的に取りながら、信頼度を最適に調整する能力こそが、カルマンフィルタが様々な状況で頑健に機能する秘訣です 5。

### **3.2 最適性の数学：1次元カルマンゲインの導出**

カルマンゲインが「最適」であると言われるのは、それが単なる経験則ではなく、厳密な数学的最適化の結果だからです。このセクションでは、専門的なレポートとしての要件を満たすため、カルマンゲインの式を第一原理から導出します。これにより、カルマンゲインが魔法ではなく、推定誤差を最小化するという明確な目的から導かれる必然的な結果であることが明らかになります。

**目標**: 事前推定値 x^− と観測値 z の線形結合として新しい推定値 x^ を求め、その推定誤差 (x−x^) の分散を最小化すること 6。

**1次元の場合の導出ステップ**:

1. 更新後の推定値の定義:  
   まず、更新後の推定値 x^ は、事前推定値 x^− を、観測値と予測値の差（イノベーション）を用いて補正する形で表せます。ここで、k はその補正の度合いを決めるゲインです。  
   x^=x^−+k(z−x^−)=(1−k)x^−+kz

   この式は、更新後の推定値が事前推定値と観測値の加重平均であることを示しています 12。  
2. 推定誤差の分散の表現:  
   この新しい推定値 x^ の誤差の分散 p を計算します。真の状態を x、観測ノイズを v とすると、z=x+v と書けます。事前推定誤差の分散を p−、観測ノイズの分散を r とします。x^− の誤差 (x^−−x) と観測ノイズ v は無相関であると仮定すると、x^ の誤差 (x^−x) の分散 p は以下のように計算されます。  
   p=Var(x^−x)=Var((1−k)x^−+k(x+v)−x)p=Var((1−k)(x^−−x)+kv)

   分散の加法性（独立な確率変数の和の分散は分散の和）を用いると、  
   p=(1−k)2Var(x^−−x)+k2Var(v)p=(1−k)2p−+k2r

   この式は、更新後の分散 p が、ゲイン k、事前分散 p−、観測分散 r の関数であることを示しています 12。  
3. 分散の最小化:  
   この分散 p を最小にするようなゲイン k を見つけるために、p を k で微分し、その導関数をゼロに設定します 1。dkdp​=dkd​((1−k)2p−+k2r)dkdp​=−2(1−k)p−+2kr  
4. カルマンゲインの導出:  
   導関数をゼロとおいて、k について解きます。  
   −2(1−k)p−+2kr=0kr=(1−k)p−kr=p−−kp−k(r+p−)=p−k=p−+rp−​

   これが、1次元の場合の有名なカルマンゲインの公式です 9。

**結論**: この導出は、カルマンフィルタが単なる優れたヒューリスティックではないことを証明しています。ノイズがガウス分布に従う線形システムにおいて、カルマンフィルタは\*\*最良線形不偏推定量（Best Linear Unbiased Estimator, BLUE）\*\*となります。なぜなら、カルマンゲインは各ステップで推定誤差の分散を最小化するように特別に計算されるからです 1。これにより、統計的に最も確からしい推定値が保証されるのです。

## **第4部：フィルタの言語：状態空間モデル**

これまで直感的な説明と1次元の例を用いてきましたが、現実世界の多くの問題は多次元です。例えば、物体の状態は位置と速度、あるいは位置・速度・加速度といった複数の変数（ベクトル）で記述されます。このような多次元の問題を扱うために、カルマンフィルタは**状態空間モデル**という数学的な枠組みを用います。

### **4.1 システムの形式化：状態方程式と観測方程式**

状態空間モデルは、システムの振る舞いを二つの方程式で記述します。

* 状態方程式 (State Equation):  
  この方程式は、システムの内部状態が時間とともにどのように変化するか（システムの「物理法則」）を記述します 16。

  $$ \\boldsymbol{x}\_k \= \\boldsymbol{F}k \\boldsymbol{x}{k-1} \+ \\boldsymbol{B}\_k \\boldsymbol{u}k \+ \\boldsymbol{w}{k-1} $$  
  各項の意味は以下の通りです 1。  
  * xk​: 時刻 k における**状態ベクトル**。例えば、物体の位置と速度を表す \[positionvelocity​\] のような列ベクトルです。  
  * Fk​: **状態遷移行列**。外部からの力がない場合に、時刻 k−1 の状態 xk−1​ が時刻 k の状態 xk​ にどのように遷移するかを定義します。例えば、等速直線運動モデルでは、位置は「前の位置＋速度×時間」で更新され、速度は一定です。  
  * Bk​uk​: **制御入力モデル**。uk​ はスロットル操作による加速度など、既知の外部からの制御入力を表す**制御ベクトル**、Bk​ はその入力が状態にどのような影響を与えるかを示す**制御入力行列**です。  
  * wk−1​: **プロセスノイズベクトル**。システムのモデル化では捉えきれない、予測不可能な外乱（突風など）を表します。平均がゼロで、共分散が Qk​ のガウス分布に従うと仮定されます 6。  
* 観測方程式 (Observation Equation):  
  この方程式は、システムの内部状態 xk​ と、我々が実際にセンサーで測定できる観測値 zk​ との関係を記述します。  
  zk​=Hk​xk​+vk​

  各項の意味は以下の通りです 1。  
  * zk​: 時刻 k における**観測ベクトル**。センサーからの測定値を集めたベクトルです。  
  * Hk​: **観測行列**。直接観測できない可能性のある状態ベクトル xk​ を、観測可能な測定値の空間に写像（変換）する役割を持ちます。例えば、状態が位置と速度のベクトル \[positionvelocity​\] であっても、センサーが位置しか測定できない場合、観測行列は H=\[1​0​\] となり、状態ベクトルから位置成分だけを抽出します 19。  
  * vk​: **観測ノイズベクトル**。センサーの測定誤差を表します。平均がゼロで、共分散が Rk​ のガウス分布に従うと仮定されます 6。

### **4.2 不確実性の定量化：三位一体の共分散行列（P, Q, R）**

カルマンフィルタの挙動を理解し、適切に実装する上で、三つの重要な共分散行列 (P, Q, R) の役割を正確に把握することが不可欠です。これらはしばしば混乱の元となりますが、その関係性は明確です。

* R \- 観測ノイズ共分散行列: フィルタに教える情報  
  この行列は、使用するセンサーの不確実性、すなわち測定誤差の大きさを定量化したものです。通常、センサーのデータシートに記載されている仕様（精度など）から設定したり、静止した対象物を繰り返し測定してそのデータの分散を計算したりすることで決定します 2。  
  R の対角成分は各測定値の分散を、非対角成分は異なる測定値間の誤差の相関（共分散）を表します。多くの場合、センサー間の誤差は独立していると仮定され、R は対角行列となります。  
* Q \- プロセスノイズ共分散行列: フィルタに教える情報  
  この行列は、状態方程式（システムモデル）がどれだけ現実を正確に表現しているか、その信頼度を定量化したものです。つまり、モデル化されていないダイナミクス（風、摩擦、路面の傾斜など）によって生じる状態の不確実性を表します 2。  
  Q の値は、しばしば決定するのが最も難しいパラメータであり、フィルタの性能を調整するための「チューニングパラメータ」として扱われることがよくあります。Q を大きく設定すると、フィルタは「自分のモデルはあまり信用できない」と判断し、観測値をより重視するようになります。逆に小さくすると、モデルをより信頼し、観測ノイズの影響を受けにくくなります。  
* P \- 誤差共分散行列: フィルタが教えてくれる情報  
  この行列は、フィルタの状態そのものの一部であり、フィルタ自身の推定値 x^ がどれだけの不確かさを持っているかを表します。これはユーザーが設定するものではなく、予測と更新のサイクルを通じてフィルタ自身が計算し、更新し続ける値です 20。  
  P の対角成分は、各状態変数（位置、速度など）の推定誤差の分散を表し、非対角成分は異なる状態変数の誤差間の相関（共分散）を表します。例えば、位置の誤差と速度の誤差がどのように関連しているかを示します 20。

これらの共分散行列の間には、明確な情報の流れ、すなわち因果連鎖が存在します。ユーザーが設定した Q（モデルへの不信）は、予測ステップで誤差共分散 P を増大させる要因となります。次に、この増大した P（フィルタ自身の不確かさ）が、ユーザーが設定した R（センサーへの不信）と比較され、カルマンゲイン K が計算されます。センサーに比べて自身の不確かさが大きい（P が大きく R が小さい）と判断したフィルタは、大きな K を生成し、新しい観測データをより強く信頼します。そして、この K の値が、更新ステップで誤差共分散 P をどれだけ減少させるかを決定します 1。

したがって、カルマンフィルタのチューニングとは、本質的に Q と R を適切に設定する作業に他なりません。これら二つの行列が、フィルタの内部状態である P と、それによって決まるカルマンゲイン K の動的な振る舞いを支配し、結果としてフィルタ全体の性能を決定づけるのです。これらは、フィルタが自身のモデルと外部からのデータに対して抱く「懐疑心」を調整するための、二つの重要なノブなのです。

## **第5部：フィルタの実践：数値計算例**

これまでの理論的な概念を具体的に理解するために、単純な1次元の問題に対するカルマンフィルタの動作を、ステップバイステップの数値例で追ってみましょう。題材として、ノイズの多い温度計を使って、一定温度の液体の温度を推定する問題を考えます 23。

### **5.1 理論から実践へ：一定温度の推定**

**問題設定**:

* **状態 (x)**: 推定したい対象である、液体の真の温度（スカラー量）。  
* モデル: 液体の温度は一定であると仮定します。したがって、時刻 k の温度は時刻 k−1 の温度と同じはずです。  
  xk​=xk−1​

  これは、状態遷移行列が F=1 であることを意味します。外部からの制御入力はないため、B=0 です。ただし、現実には微小な温度変動がありうるため、その不確かさをモデル化するために、非常に小さなプロセスノイズ Q を仮定します。  
* **観測 (z)**: 温度計による測定値。温度を直接測定できるため、観測行列は H=1 です。  
* **初期値とノイズ**:  
  * 初期推定値: x^0​=10.0 °C （最初の当て推量）  
  * 初期誤差共分散: P0​=10000 （最初の推定には全く自信がないことを示す大きな値）  
  * プロセスノイズの分散: Q=0.0001 （モデルは非常に正確で、状態はほとんど変化しないという仮定）  
  * 観測ノイズの分散: R=0.01 （温度計の測定誤差の分散。標準偏差で0.1°Cに相当）

### **5.2 表：カルマンフィルタの反復計算**

以下の表は、新しい観測値が得られるたびに、カルマンフィルタの主要な変数がどのように進化していくかを示しています。この表を追うことで、推定値が真の値に収束し、その不確かさ（分散 P）が劇的に減少していく様子が定量的に分かります。これにより、抽象的な数式が具体的な計算プロセスへと変わります 23。

**計算式サマリー**:

1. **予測**:  
   * 事前推定値: x^k−​=Fx^k−1​  
   * 事前誤差共分散: Pk−​=FPk−1​FT+Q  
2. **更新**:  
   * カルマンゲイン: Kk​=HPk−​HT+RPk−​HT​  
   * 事後推定値: x^k​=x^k−​+Kk​(zk​−Hx^k−​)  
   * 事後誤差共分散: Pk​=(I−Kk​H)Pk−​

**反復計算の表**

| 反復 (k) | 観測値 (zk​) | 予測 (x^k−​,Pk−​) | カルマンゲイン (Kk​) | 更新 (x^k​,Pk​) |
| :---- | :---- | :---- | :---- | :---- |
| 0 (初期値) | \- | x^0​=10.0 P0​=10000 | \- | \- |
| 1 | 49.95 °C | x^1−​=1×10.0=10.0 P1−​=1×10000×1+0.0001=10000.0001 | K1​=10000.0001+0.0110000.0001​≈0.99999 | x^1​=10.0+0.99999(49.95−10.0)≈49.95 P1​=(1−0.99999)×10000.0001≈0.01 |
| 2 | 50.01 °C | x^2−​=1×49.95=49.95 P2−​=1×0.01×1+0.0001=0.0101 | K2​=0.0101+0.010.0101​≈0.5025 | x^2​=49.95+0.5025(50.01−49.95)≈49.98 P2​=(1−0.5025)×0.0101≈0.0050 |
| 3 | 49.98 °C | x^3−​=1×49.98=49.98 P3−​=1×0.0050×1+0.0001=0.0051 | K3​=0.0051+0.010.0051​≈0.3377 | x^3​=49.98+0.3377(49.98−49.98)≈49.98 P3​=(1−0.3377)×0.0051≈0.0034 |
| 4 | 50.03 °C | x^4−​=1×49.98=49.98 P4−​=1×0.0034×1+0.0001=0.0035 | K4​=0.0035+0.010.0035​≈0.2593 | x^4​=49.98+0.2593(50.03−49.98)≈49.99 P4​=(1−0.2593)×0.0035≈0.0026 |

**分析**:

* **反復1**: 最初の推定値（10.0）は全く自信がなかったため（P0​が非常に大きい）、カルマンゲイン K1​ はほぼ1になりました。これは「自分の予測は捨てて、観測値を全面的に信用する」という判断を意味し、推定値 x^1​ は観測値 z1​ とほぼ同じ値になりました。同時に、誤差の分散 P1​ は観測ノイズの分散 R とほぼ同じレベルまで劇的に減少しました。  
* **反復2以降**: 2回目以降、フィルタは自身の推定値にある程度の自信を持っています（Pが小さい）。そのため、カルマンゲインは1よりずっと小さい値になります。これは、新しい観測値と自身の予測値をバランスよく混ぜ合わせていることを示しています。  
* **収束**: 反復を重ねるごとに、推定値 x^k​ は真の値（この例では約50.0）に近づき、誤差共分散 Pk​ は着実に減少し、推定がより確実なものになっていく様子が観察できます。

## **第6部：より広い視野と実践的な考察**

### **6.1 現実世界へのインパクト：遍在するアルゴリズム**

カルマンフィルタは、その理論的なエレガンスと実用的な頑健性から、現代科学技術の非常に多くの分野で不可欠なツールとなっています。その応用範囲の広さは、このアルゴリズムの根本的な有用性を物語っています 2。

* **航法システム**: GPSとIMU（慣性計測装置）のデータを融合し、航空機、船舶、自動車、さらにはスマートフォンの正確な位置と向きを推定するために広く使われています。  
* **目標追跡**: 防衛分野におけるレーダーやソナーでの敵機・潜水艦の追跡、気象学における台風の進路予測など、動的オブジェクトの軌道を予測・追跡するあらゆる場面で活躍します 2。  
* **ロボット工学**: 移動ロボットが自身の位置を推定し、環境地図を作成する技術（SLAM: Simultaneous Localization and Mapping）や、4脚ロボットやヒューマノイドがバランスを保つための姿勢推定において中心的な役割を果たします 1。  
* **コンピュータビジョン**: ビデオ映像内の人物や車両など、特定のオブジェクトをフレーム間で追跡するために利用されます。  
* **経済学・金融工学**: 観測ノイズの多い経済指標から潜在的な経済状態を推定したり、金融商品の価格変動をモデル化したりするために状態空間モデルと共に用いられます。  
* **制御システム**: システムの状態を正確に推定することで、より高精度なフィードバック制御を実現します。例えば、倒立振子の安定化制御などが挙げられます 24。

このように、カルマンフィルタは不確実なデータから意味のある情報を引き出すという普遍的な課題に対する、強力な解決策として、社会の様々な場面で機能しているのです。

### **6.2 部屋の中の象：線形性の仮定**

これまでの議論で、カルマンフィルタが「最適」な推定器であると述べてきましたが、これには重要な前提条件が付きます。標準的なカルマンフィルタは、**システムが線形であり、かつノイズがガウス分布に従う**場合にのみ、数学的に最適であることが保証されています 6。

* **線形システムとは**: 状態方程式と観測方程式が、状態変数の線形結合（足し算と定数倍）で記述できるシステムを指します。例えば、xk​=axk−1​+b は線形ですが、xk​=sin(xk−1​) は非線形です。  
* **ガウスノイズとは**: プロセスノイズと観測ノイズの確率分布が、釣鐘型の正規分布（ガウス分布）に従うという仮定です。

現実世界の多くのシステム、特にロボットの運動学や空気力学などを含むシステムは、本質的に**非線形**です。例えば、ロボットアームの動きは角度に関する三角関数（sin,cos）を含みます。このような非線形システムに標準的なカルマンフィルタを適用しようとすると、フィルタの性能は著しく低下し、場合によっては発散してしまう（推定値が無限大に飛んでいく）ことさえあります。

### **6.3 その先へ：拡張（EKF）および無香料（UKF）カルマンフィルタ**

線形性という大きな制約を乗り越えるために、カルマンフィルタにはいくつかの重要な拡張版が存在します。専門家として、あるいはより高度な問題に取り組む開発者として、これらの存在を知っておくことは極めて重要です。

* 拡張カルマンフィルタ (Extended Kalman Filter, EKF):  
  非線形システムを扱うための最も古典的で一般的なアプローチです。EKFの基本的なアイデアは、非線形な状態方程式や観測方程式を、現在の推定値の周りで線形近似することです。具体的には、関数の勾配を表す「ヤコビ行列」を用いて、各ステップでシステムを局所的に線形化します。EKFは多くの応用で成功を収めていますが、強い非線形性を持つシステムでは近似誤差が大きくなり不安定になる可能性があるほか、ヤコビ行列の導出が複雑で実装が難しいという欠点があります 21。  
* 無香料カルマンフィルタ (Unscented Kalman Filter, UKF):  
  EKFとは異なるアプローチで非線形性の問題に取り組みます。UKFは、確率分布を線形近似するのではなく、確率分布そのものを表現する少数の代表点（シグマポイント）を選び出します。そして、これらのシグマポイントを非線形の関数に直接通し、変換後のシグマポイントから新しい確率分布（平均と共分散）を再計算します。この「無香料変換（Unscented Transform）」と呼ばれる手法は、関数の線形化を必要とせず、EKFよりも高次のモーメントを捉えることができるため、一般的にEKFよりも高精度で頑健であるとされています。また、ヤコビ行列の計算が不要なため、実装が容易になる場合も多いです。

本稿で解説した標準的なカルマンフィルタの概念は、これらEKFやUKFといったより高度な推定手法を理解するための、不可欠な基礎となります。予測と更新のサイクル、状態空間モデルの考え方、そして共分散行列が担う不確実性管理の役割といった核心的なアイデアは、これらの拡張版フィルタにも共通して流れているからです。不確実な世界を航海するための最初の、そして最も重要な羅針盤として、カルマンフィルタの原理を深く理解することは、あらゆるエンジニアや科学者にとって計り知れない価値を持つでしょう。

#### **引用文献**

1. カルマンフィルタの基礎について解説！ \- AGIRobots Blog, 6月 23, 2025にアクセス、 [https://developers.agirobots.com/jp/kalman-filtering/](https://developers.agirobots.com/jp/kalman-filtering/)  
2. カルマンフィルターチュートリアル \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/default\_jp.aspx](https://www.kalmanfilter.net/JP/default_jp.aspx)  
3. カルマンフィルタってなに？ \#機械学習 \- Qiita, 6月 23, 2025にアクセス、 [https://qiita.com/IshitaTakeshi/items/740ac7e9b549eee4cc04](https://qiita.com/IshitaTakeshi/items/740ac7e9b549eee4cc04)  
4. カルマンフィルタ入門 | PPT \- SlideShare, 6月 23, 2025にアクセス、 [https://www.slideshare.net/slideshow/ss-250284912/250284912](https://www.slideshare.net/slideshow/ss-250284912/250284912)  
5. カルマンフィルタの考え方 \- Logics of Blue, 6月 23, 2025にアクセス、 [https://logics-of-blue.com/kalman-filter-concept/](https://logics-of-blue.com/kalman-filter-concept/)  
6. Kalman Filter入門 \#統計学 \- Qiita, 6月 23, 2025にアクセス、 [https://qiita.com/categoryik/items/3d1ea237998bc1c0da61](https://qiita.com/categoryik/items/3d1ea237998bc1c0da61)  
7. まとめ \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/multiSummary\_jp.html](https://www.kalmanfilter.net/JP/multiSummary_jp.html)  
8. qiita.com, 6月 23, 2025にアクセス、 [https://qiita.com/IshitaTakeshi/items/740ac7e9b549eee4cc04\#:\~:text=%E3%81%BE%E3%81%9A%E5%9F%BA%E7%A4%8E%E7%9A%84%E3%81%AA%E3%81%93%E3%81%A8,%E5%87%A6%E7%90%86%E3%81%AF%E8%A1%8C%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93%EF%BC%8E](https://qiita.com/IshitaTakeshi/items/740ac7e9b549eee4cc04#:~:text=%E3%81%BE%E3%81%9A%E5%9F%BA%E7%A4%8E%E7%9A%84%E3%81%AA%E3%81%93%E3%81%A8,%E5%87%A6%E7%90%86%E3%81%AF%E8%A1%8C%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93%EF%BC%8E)  
9. 第1回 カルマンフィルタとは \- 地層科学研究所, 6月 23, 2025にアクセス、 [https://www.geolab.jp/documents/column/kalman01/](https://www.geolab.jp/documents/column/kalman01/)  
10. カルマンフィルタの基礎式を代数とベイズ定理から見る \- am I geek...?, 6月 23, 2025にアクセス、 [http://hamachan-pon.blogspot.com/2017/04/blog-post.html](http://hamachan-pon.blogspot.com/2017/04/blog-post.html)  
11. カルマンゲイン \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/kalmanGain\_jp.html](https://www.kalmanfilter.net/JP/kalmanGain_jp.html)  
12. 1次元カルマンゲインの導出 \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/KalmanGainDeriv\_jp.html](https://www.kalmanfilter.net/JP/KalmanGainDeriv_jp.html)  
13. One-dimensional Kalman Gain Derivation, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/KalmanGainDeriv.html](https://www.kalmanfilter.net/KalmanGainDeriv.html)  
14. カルマンフィルターの簡単な計算例を探究 with Excel and R, 6月 23, 2025にアクセス、 [https://fmurakami.securesite.jp/kalmansm.html](https://fmurakami.securesite.jp/kalmansm.html)  
15. Kalman filter \- Wikipedia, 6月 23, 2025にアクセス、 [https://en.wikipedia.org/wiki/Kalman\_filter](https://en.wikipedia.org/wiki/Kalman_filter)  
16. 状態方程式 \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/stateextrap\_jp.html](https://www.kalmanfilter.net/JP/stateextrap_jp.html)  
17. カルマンフィルタの基礎について詳しく解説！ \- YouTube, 6月 23, 2025にアクセス、 [https://www.youtube.com/watch?v=GH4AficLbLM](https://www.youtube.com/watch?v=GH4AficLbLM)  
18. 素人によるカルマンフィルタの基礎の入門 \#制御工学 \- Qiita, 6月 23, 2025にアクセス、 [https://qiita.com/sakaeda11/items/6b9bfa2e922304b5edab](https://qiita.com/sakaeda11/items/6b9bfa2e922304b5edab)  
19. 観測方程式 \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/measurement\_jp.html](https://www.kalmanfilter.net/JP/measurement_jp.html)  
20. カルマンフィルタの誤差共分散の意味 \- ヤカンヒコウ, 6月 23, 2025にアクセス、 [https://blog.chachay.org/2020/08/kalman-filter.html](https://blog.chachay.org/2020/08/kalman-filter.html)  
21. パラメータ推定（２）カルマンフィルター \#制御工学 \- Qiita, 6月 23, 2025にアクセス、 [https://qiita.com/taka\_horibe/items/f85553c0ef842658e427](https://qiita.com/taka_horibe/items/f85553c0ef842658e427)  
22. 第 6 章 多変量カルマンフィルタ \- Python で学ぶベイズフィルタとカルマンフィルタ (翻訳), 6月 23, 2025にアクセス、 [https://inzkyk.xyz/kalman\_filter/multivariate\_kalman\_filters/](https://inzkyk.xyz/kalman_filter/multivariate_kalman_filters/)  
23. 1次元カルマンフィルタ \- Kalman Filter Tutorial, 6月 23, 2025にアクセス、 [https://www.kalmanfilter.net/JP/kalman1d\_jp.html](https://www.kalmanfilter.net/JP/kalman1d_jp.html)  
24. 確率・統計処理＆真値推定！自動運転時代のカルマン・フィルタ入門 \- ZEPエンジニアリング, 6月 23, 2025にアクセス、 [https://www.zep.co.jp/nbeppu/web\_seminar/kalman\_all/index.html](https://www.zep.co.jp/nbeppu/web_seminar/kalman_all/index.html)