

---

### IPMSMの磁束変動下におけるトルク補償

#### はじめに

埋込磁石同期モータ（IPMSM）は、永久磁石の減磁特性により、温度が上昇すると磁石の鎖交磁束が減少します。この高温時の磁束の弱まりは、特定の電流に対して生成される電磁トルクを直接的に減少させます。言い換えれば、磁石の温度が上昇しても、駆動システムが単に同じ電流指令値（例えば、固定のMTPA電流ルックアップテーブルを使用）を維持するだけでは、トルク出力は低下してしまいます。研究によれば、磁石温度が上昇（PMの残留磁束が減少）すると、同じトルクを生成するためにより多くのステータ電流が必要になることが確認されています。したがって、補償技術の目標は、推定された磁束の変化に基づいて制御指令を調整することにより、磁束の変動にもかかわらず出力トルクを一定に保つことです。

IPMSMの効率的なトルク制御には、ベクトル制御（FOC）とMTPA（最大トルク/電流）制御が一般的に使用されます。公称条件下では、ルックアップテーブル（LUT）が特定のトルクに対する最適なd軸およびq軸電流指令値（MTPA軌道）を提供します。しかし、温度に起因するパラメータの変動、特に磁石磁束の減少は、そのLUTがもはや意図したトルクを生成しないことを意味します。補正されなければ、指令トルクと実トルクは条件の変化とともに乖離します。従来の解決策としては、温度範囲全体にわたって複数のMTPA LUTを準備し、それらを補間する方法があります。これにより、各温度での磁束を考慮した電流指令が保証されますが、広範なオフラインでのマッピングが必要となり、メモリ使用量も増加します。

これに対し、現代の研究では、オンラインでの磁束推定を用いてリアルタイムに制御指令を調整し、LUTを交換することなく正確なトルクを維持する動的な補償アルゴリズムが探求されています。大きく分けて2つのアプローチがあります。

(A) **電流指令値の調整**: 推定された磁石磁束に基づいてd/q軸電流指令を再計算または補正し、新しい磁束レベルで所望のトルクを生成する新たな動作点を効果的に見つけ出す。これには、MTPA効率を維持するためのオンラインパラメータ推定や最適化が含まれることが多い。
(B) **トルク指令値のスケーリング**: 磁束の変化を補償するためにトルク指令自体を修正（またはトルクフィードバックループを追加）し、既存のLUTやコントローラを介して得られる電流が意図したトルクを生成するようにする。これはMTPA LUTをそのまま使用し、それに与えるトルク指令値をスケーリングまたは補正する。

ここでの焦点は、(B)のアプローチ、すなわち、実行時に電流ルックアップテーブルを明示的に再計算するのではなく、トルク指令をスケーリングまたは補正する（あるいはトルクフィードバック制御を使用する）手法です。これらの手法は、MTPAテーブルを変更することなく、推定された磁石磁束値を利用してトルク出力を一定に保つことを目指します。

#### 温度がIPMSMのトルクとMTPAに与える影響

補償について議論する前に、温度がIPMSMのトルク生成にどのように影響するかを理解することが重要です。IPMSMの電磁トルクは（d-q座標系で）次のように表せます。
$$T_e = \frac{3}{2}p\big[\psi_\mathrm{pm} \, I_q + (L_d - L_q) I_d\, I_q\big]$$
ここで、$p$は極対数、$\psi_{\mathrm{pm}}$はPMの鎖交磁束（磁石温度に影響される）、$L_d, L_q$はd軸およびq軸のインダクタンスです。磁石温度が上昇すると、$\psi_{\mathrm{pm}}$はほぼ線形に減少します（例：ネオジム磁石は約-0.1%/°Cの負の磁束温度係数を持つ）。$\psi_{\mathrm{pm}}$の低下は、上式の第1項（磁石トルク）を直接減少させます。第2項のリラクタンストルクは、温度や飽和によってインダクタンスがわずかに変化するものの、温度による直接的な影響は少ないです。全体として、温度が高くなると、特定のトルクに対する最適なd-q電流の組み合わせが変化します。磁石が弱くなると、MTPA点は同じ合計トルク $T_e$ を生成するためにより多くの$I_q$（そして場合によってはわずかに異なる$I_d$）を要求するようになります。

**MTPA LUTの感度**: 従来のMTPA LUTは、特定のモータモデル（多くは「基準」温度）に対して生成されます。磁石磁束や抵抗がこれらの公称値からずれると、LUTの出力（特定のトルクに対する最適な$I_d$, $I_q$）はもはや真に最適ではなくなり、期待とは異なるトルクを生成します。例えば、$\psi_{\mathrm{pm}}$が低下した場合、より高い$\psi_{\mathrm{pm}}$を想定して計算されたLUTの$I_q$は、表示されているよりも少ないトルクしか生成しません。事実上、モータは指令されたトルクに対して「トルク不足」の状態になります。研究者たちは、このトルク誤差が磁石温度とともに増大し、性能と効率の両方を低下させる可能性があることを観測しています。

補償がない場合、駆動システムは高温時に顕著なトルク低下（電流を増やさない限り同じトルクを達成できない）を経験する可能性があります。テストによれば、PMの鎖交磁束が（例えば20%）減少すると、是正措置が取られない限り、駆動システムのトルク出力は指令値を下回ります。自動車応用では、このトルク低下は車両の加速や応答性に影響を与える可能性があり、そのため補償戦略が必要となります。

#### 磁束推定に基づくトルク指令補償

一貫したトルク出力を維持するために、現代の戦略ではリアルタイムの磁石磁束（または直接的に発生トルク）を推定し、この情報を使用してトルク指令を調整したり、トルク制御ループを起動したりします。これにより、MTPAテーブル自体を変更することなく、パラメータの変化にもかかわらず電磁トルクが目標レベルに留まることが保証されます。以下に、このカテゴリの主要な手法を、アルゴリズムや実装例とともに概説します。

##### 1. 推定磁束によるフィードフォワード・トルクスケーリング

簡単なアプローチは、推定された磁石磁束の変化に応じてトルク指令値をスケーリングすることです。現在の温度における推定PM鎖交磁束を$\hat{\psi}_{\mathrm{pm}}$（LUTが導出された基準温度での磁束を$\psi_{\mathrm{pm,base}}$）とすると、トルク指令$T_{\mathrm{ref}}$を磁束比にほぼ等しい係数で調整できます。簡単に言えば、
$$T_{\mathrm{ref,comp}} \approx T_{\mathrm{ref}} \times \frac{\psi_{\mathrm{pm,base}}}{\hat{\psi}_{\mathrm{pm}}}$$
このフィードフォワードゲインにより、$\hat{\psi}_{\mathrm{pm}}$が減少すると内部的なトルク要求が高まり、コントローラは実際のトルクが元の指令値に達するまで$I_q$を増加させます。事実上、コントローラは弱まった磁石を相殺するために「より多くのトルクを要求」するのです。すべてのトルクが磁石磁束から得られる表面磁石同期モータ（SPMSM）では、この線形スケーリングが直接トルク損失を補償できます。実際、ParkとLee（2017）は、磁石の鎖交磁束が温度とともに低下すると、実際のトルクが目標トルクと等しくなるように、指令電流（主に$I_q$）を増加させる必要があると指摘しています。彼らのSPMSMでのテストでは、磁石温度100°Cにおいて、駆動システムは25°C時と比較して自動的に電流の大きさを引き上げ、出力トルクを指令レベルに維持することに成功しました。

**逆起電力に基づく補正**: 直接的なセンサなしで磁束の減少を測定する実用的な方法の一つは、逆起電力の推定です。無負荷時の逆起電力は$\psi_{\mathrm{pm}} \omega$（回転子磁束 × 角速度）に比例します。したがって、特定の速度で観測されるEMFの低下は、磁石磁束の低下を示します。Kangら（2021）は、逆起電力の変化を用いたトルク指令補償技術を実装しました。彼らは、測定されたBEMFの減少に基づいてトルク指令を調整するために、中間温度で小さなLUTを作成しました。本質的に、トルク指令は磁束の不足分（EMFから推測）に比例して増加されました。この方法は高温時のトルク精度を向上させましたが、著者らは欠点を指摘しています。もしトルク指令をEMFの大きさの変化のみ（つまり$\psi_{\mathrm{pm}}$の低下のみを考慮）で補償し、インダクタンスの変化を無視すると、動作点が真の最適点からずれてしまい、追加の損失を引き起こす可能性があります。中間温度のLUTは、高温時の新たな最適な$I_d, I_q$に関する情報を持っていなかったため、効率は理想的ではありませんでした。言い換えれば、トルク指令を純粋に磁束比でスケーリングすることは、トルクは回復させましたが、最適な電流配分は回復させませんでした。
それを軽減するために、後の手法ではより多くのモータパラメータを補償に組み込んでいます。

##### 2. トルクフィードバック制御（閉ループ補償）

一度きりの指令スケーリングではなく、多くのシステムでは推定されたトルクオブザーバを用いた閉ループのトルク制御を実装します。ここでは、外側のループが指令トルクと（リアルタイムで推定される）実トルクの差を監視し、その誤差をなくすようにトルク指令（または電流指令）を調整します。これは実質的に、パラメータ変動にもかかわらず出力トルクが指令値に追従することを保証するトルクレギュレータを形成します。

顕著な例は、Muazzamら（2022）によって提案されたLPVベースのトルク制御アーキテクチャです。彼らは、劣化したPM鎖交磁束と瞬時トルクをリアルタイムで推定する線形パラメータ変動（LPV）オブザーバを設計しました。これらの推定値は、熱的影響を補償するためにFOCのトルク生成電流指令をスケーリングする閉ループコントローラに供給されます。本質的に、オブザーバが（磁束の弱化や抵抗の増加により）トルク生成が不足していることを検出するたびに、コントローラは要求されたトルクを維持するために電流を増加させます。このアプローチは、動的なEVのドライブサイクル全体でトルク追従誤差を非常に低く抑え、補償なしの従来のFOCと比較してトルク偏差を大幅に削減しました。重要なことに、この方式は複数のMTPAテーブルを必要とせず、代わりにフィードバックを介してリアルタイムで調整します。LPVオブザーバは、温度によるステータ抵抗の上昇も考慮しており、トルク精度をさらに向上させます。

別の例として、Sulとその同僚によって探求された「トルクフィードバックMTPA制御」の概念があります。Kim & Sul（2022）は、磁束変動下で高いトルク精度と高効率の両方を達成するリアルタイムトルク制御を提案しました。彼らの独自手法の詳細は複雑ですが、一般的な考え方は、推定されたトルク式をフィードバックとして使用することです。推定された電磁トルクと指令値を継続的に比較することにより、コントローラはトルク誤差を補正するために電流ベクトルを随時調整できます。これにより、指令されたトルク出力を維持しつつ、$I_d-I_q$をわずかに摂動させることで、効率のためのMTPA軌道上（またはその近く）に留まります。事実上、システムは現在の鎖交磁束を前提として、要求されたトルクを生成する最適な電流位相角を追跡します。Choら（2019）も同様に、制御ループ内でオンラインパラメータ推定器を使用してトルク減少を補償するアプローチを開発しました。彼らの方法は、FOCの制御入力を数値的に調整し、広い磁石温度範囲にわたって効果的なトルク補償を達成しました。これらはトルク指令補正の高度な形式と見なすことができます。固定のスケーリングではなく、トルク指令がコントローラによって継続的に微調整され、トルク誤差をゼロにする（速度ループでPIコントローラが速度誤差をゼロにするのと同様に）のです。

閉ループトルク補償の利点の一つは、モデリングの不確かさに対するロバスト性です。正確な磁束値が事前にわからなくても、システムはトルク誤差をゼロに駆動します。Park & LeeのSPMSMアルゴリズムは、これを明確に示しています。彼らはステータ鎖交磁束オブザーバを使用してPM磁束をリアルタイムで推定し、この推定値に基づいてq軸電流指令を補正します。補正された$I_q^*$が電流コントローラに供給され、磁束が減少しても発生トルクが目標値と一致することが保証されます。本質的に、磁石磁束が低下するたびに、オブザーバはそれを（推定鎖交磁束の低下を介して）感知し、コントローラはトルク誤差がなくなるまで$I_q$指令を増加させます。彼らの結果は、この補償が有効な場合、100°Cでのトルク応答が同じトルク指令に対して25°Cでの応答とほぼ同一であることを示しました。唯一の変化は、同じトルクを生成するために予想通り高温時に電流要求が高くなることであり、これはアルゴリズムが内部で実効的なトルク指令を「スケーリング」して出力トルクを一定に保つことに成功したことを証明しています。特筆すべきは、これが磁石温度センサなしで、純粋に磁束オブザーバ内の電気的測定（電圧/電流）をフィードバックとして用いて行われたことです。

##### 3. 単一LUTを用いた最適な電流の再計算（ハイブリッドアプローチ）

トルク指令の調整と電流の調整の中間に位置するのが、ハイブリッド戦略です。これは、単一の基準MTPA LUTを保持しつつ、推定された磁束とトルクを用いて、LUTの出力に上乗せする追加の電流オフセットまたはスケーリングを計算します。このアプローチは電流指令を修正すると見なせますが、LUTを再設計するのではなく、LUTの結果を効果的にスケーリングします。最近の例として、Baekら（2023）の研究があります。

-   彼らは基準温度（例：25°C）でのLUTを1つ保持します。実行時に、彼らはモータの基本波の有効電力と無効電力を分析することにより、磁石の鎖交磁束$\hat{\psi}_{\mathrm{pm}}(T)$と実際の出力トルク$\hat{T}_e$を継続的に推定します。この推定は測定された電圧と電流を使用するため、磁石温度センサは不要です（彼らはまた、抵抗の影響を相殺するために無効電力を用いて磁束を相互検証します）。
-   （磁束の減少や他のパラメータ変動により）推定トルク$\hat{T}_e$が指令トルク$T_{\mathrm{ref}}$を下回る場合、彼らのアルゴリズムは最適化問題を定式化します。それは、トルク誤差を最小の追加電流（すなわち最小の銅損）で補正するような小さな調整量$\Delta I_d, \Delta I_q$を現在の電流指令に追加することです。彼らは目的関数$f(I_d,I_q) = I_d^2 + I_q^2$（電流の大きさ）と、所望のトルクに対する制約条件$g(I_d,I_q)=T_{\mathrm{ref}} - T_e(I_d,I_q)=0$を定義します。ラグランジュの未定乗数法を用いて、現在の磁石鎖交磁束をパラメータとして、Id-Iq平面上の最適な動作点に対する解析的な条件を導出します。これは本質的に、新しい磁束値に適したMTPA基準を再現します。
-   この解法により、必要な補償電流ベクトル$(\Delta I_d, \Delta I_q)$が得られます。これを元のLUT電流に加えると、動作点は（トルク不足だった）古い動作点から、新しい温度で指令トルクを満たす補正された動作点へと移動します。

この方法は、根底にあるLUTを変更したり、複数のLUTを必要としたりすることなく、電流指令を最適な方法で効果的にスケーリングします。これにより、トルクの精度と効率の両方が保証されます。シミュレーションでは、25°CのLUTのみとこの補償を用いることで、様々な負荷条件下で70°Cの完全なLUTを持つ場合とほぼ同等の性能を発揮できることが示されました。言い換えれば、このアルゴリズムは、温度に応じたLUTが提供するであろうものを模倣するように、トルク生成電流を動的に調整しました。これはすべてオンライン計算を通じて行われます。これは単純なトルクスケーリングよりも複雑な計算ですが、MTPAテーブル自体を変更しないという考え方を具体化したものです。代わりに、リアルタイムの補正係数（磁束推定から導出）を適用して、一定のトルク出力を達成します。

##### 4. その他の考慮事項

上記の手法はすべて、何らかの形の鎖交磁束の推定または測定が利用可能であることを前提としています。なぜなら、それがトルク能力の損失を検出する鍵となるからです。幸いなことに、磁束オブザーバはよく研究されており、アプローチは純粋な逆起電力の積分（ローパスフィルタ付き）から、モデルベースのオブザーバ、高周波注入技術まで多岐にわたります。多くの自動車用IPMSM駆動システムは、コストと信頼性の理由から直接的な磁石温度センサを省略しており、これらのセンサレス磁束推定技術は非常に価値があります。引用された補償方式（トルクフィードバック制御、磁束ベースのスケーリングなど）は、実際に直接的な温度センサなしで、代わりにオブザーバに依存して実証されています。例えば、Park & LeeのSPMSMトルク補償はGopinathスタイルの磁束オブザーバ（電圧-電流モデル融合）を使用して$\psi_{\mathrm{pm}}$をリアルタイムで推定しました。Baekらは有効/無効電力の電気的測定を使用しました。そしてMuazzamらのLPVオブザーバは磁束と生成トルクを同時にオンラインで推定します。これらのアプローチはすべて、実験で示されているように実際のハードウェアに実装可能であり、磁石温度センサや多次元LUTの必要性を回避します。

磁石の磁束低下が極端な場合（例えば、不可逆減磁に近づいている場合）、安全な操作に関する考慮事項もあることは注目に値します。一部の戦略では、磁束が著しく減少した際に磁石を保護するために意図的にトルクを制限するかもしれませんが、それは熱保護という別の問題です。補償が可能な範囲内で動作していると仮定すれば、上記の制御方法は、温度に起因する磁束変動に直面しても、電磁トルク出力を成功裏に一定に保つことができます。

#### 結論

磁束推定を活用した高度な制御戦略により、IPMSMにおける磁石磁束の変化下での一定のトルク出力を維持することが可能です。異なる温度に対応するために多くのMTPAテーブルを保存するのではなく、現代のアプローチは、単一のベースラインLUTと、トルク指令の調整またはオンラインでの電流補償を組み合わせることで、磁石の減磁効果を相殺します。

-   **推定磁束を用いたトルク指令のフィードフォワードスケーリング**は、磁束損失による定常的なトルク誤差を補正できます。これは単純で効果的ですが、リラクタンストルクや他のパラメータ変動を考慮に入れる注意が必要です。
-   **閉ループトルク制御（オブザーバ付きのトルクフィードバック）**は、あらゆるトルク不足が、誤差がなくなるまで指令トルク/電流を増加させることによって自動的に補正されることを保証します。これにより、動作条件全体で高い精度が得られ、実質的に電流/速度ループの上に外側のトルク調整ループが追加されます。
-   **最適電流注入法**は、リアルタイムの磁束推定値を使用して、最小の損失で指令トルクを生成する新たな理想的な電流ベクトルを計算し、それに応じて電流指令を調整します。これにより、異なる温度でLUTを再校正することなく、トルクの精度と効率（MTPA）の両方が達成されます。

いずれの場合も、磁束オブザーバまたは推定器が鍵となります。それらは、制御を磁石の温度状態に適応させるために必要な情報を提供します。このような磁束推定を使用することにより（直接的な温度センシングの代わりに）、これらの方法は（短期的な過負荷減磁によって引き起こされるものも含め）磁束の変化に即座に対応し、トルク出力を一定に保つことができます。文献で示されているように、磁束情報を活用したトルク補償を備えたIPMSM駆動システムは、広い温度範囲にわたってその性能を維持できます。ある研究では、トルク指令と電流を動的にスケーリングすることにより、磁石温度が65°C上昇するまで実質的にトルクの低下が見られなかったと報告されています。

全体として、IPMSMのFOC+MTPAシステムにおいて、磁束推定を介したトルク指令のスケーリングと補償は、温度に起因するトルク低下に対抗するための実現可能で効果的な戦略です。これは、複数温度のLUTの複雑さを回避し、モータの磁石がどれだけ熱くなっても、ドライバーがモータから同じトルク出力を「感じる」ことを保証し、それによって電気駆動性能の一貫性と安全性を向上させます。

#### 参考文献

- S.Y. Cho et al., “A Torque Compensation Control Scheme of PMSM Considering Wide Variation of Permanent Magnet Temperature,” IEEE Trans. Magn., 55(2), 2019.
- H.S. Kim and S.K. Sul, “Real-time Torque Control of IPMSM under Flux Variations,” IEEE J. Emerg. Sel. Top. Power Electron., 10(3), pp.3345-3356, 2022.
- H.J. Baek et al., “A Study of Reduced Torque Compensation Method Under Temperature Variation Based on Single Torque-Current LUT,” IEEE Access, 11, pp.19428-19440, 2023.
- C.S. Park and J.S. Lee, “A Torque Error Compensation Algorithm for SPMSM w.r.t. Magnet Temperature Variations,” Energies, 10(9):1365, 2017.
- H. Muazzam et al., “Compensating Thermal Derated Torque of IPMSM Centric EVs,” IEEE Access, 10, pp.24468-24480, 2022.
- D. Kang et al., “Improvement of Torque Accuracy of IPMSM Considering Temperature Variation,” Journal of Magnetics, 26(3), pp.311-321, 2021.