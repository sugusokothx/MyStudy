# Butterworthフィルタ係数設計手順書（回転ベクトル同伴フィルタ：VRAF用）

## 1. 設計概要

回転ベクトル同伴フィルタ（VRAF）は、特定の高調波成分を抽出するため、復調後にローパスフィルタ（LPF）を適用します。このLPFとして、位相特性が滑らかで安定したButterworthフィルタを使用します。

---

## 2. 必要なパラメータ

以下のパラメータを事前に決定します。

| 項目 | 記号 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| サンプリング周波数 | $F_s$ | フィルタを適用する信号のサンプリング周波数 | 12,000 Hz |
| カットオフ周波数 | $f_c$ | 抽出する周波数の低域カットオフ | 150 Hz |
| フィルタ次数 | $N$ | Butterworth LPFの次数（偶数推奨） | 4 |

---

## 3. 設計手順

### Step 1: カットオフ周波数の正規化

Butterworthフィルタ設計では、以下の式でカットオフ周波数を正規化します。

$$
W_n = \frac{f_c}{F_s/2}
$$

ここで、
- $f_c$：LPFのカットオフ周波数（Hz）
- $F_s$：サンプリング周波数（Hz）

### Step 2: フィルタ係数の計算

MATLABの`butter`関数を使ってフィルタ係数を計算します。

Matlab
$$
[b, a] = butter(N, Wn, 'low')
$$

得られる係数は以下の離散時間フィルタ差分方程式に対応します。

$$
y[n] = b_0x[n] + b_1x[n-1] + \dots + b_Nx[n-N] - a_1y[n-1] - \dots - a_Ny[n-N]
$$

## 4. 設計例（Fs=12000 Hz, fc=150 Hz, N=4）

以下のMATLABコードを実行すると、Butterworthフィルタ係数が計算されます。

```matlab
% フィルタ設計パラメータ設定
Fs = 12000;           % サンプリング周波数 [Hz]
fc = 150;             % カットオフ周波数 [Hz]
order = 4;            % Butterworthフィルタ次数（偶数推奨）

% 正規化カットオフ周波数計算
Wn = fc / (Fs/2);

% Butterworth LPF係数を計算
[b, a] = butter(order, Wn, 'low');
```

## 5. C言語での使用例

MATLABで計算したButterworthフィルタの係数は、以下のようにC言語の配列として定義できます。

※以下は一例です。実際にはMATLABで `[b, a] = butter(...)` を実行して得られた値を使用してください。

```c
// Butterworth LPF coefficients (Fs = 12000 Hz, fc = 150 Hz, order = 4)
// ※ MATLABで事前計算した値を貼り付ける

float b[5] = {0.000004f, 0.000018f, 0.000027f, 0.000018f, 0.000004f};
float a[5] = {1.000000f, -3.913020f, 5.744030f, -3.748118f, 0.917109f};
```
